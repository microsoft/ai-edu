
## 1.5 几个基本的数学概念

为了继续学习后面的知识，我们先回顾一下以下几个基本的数学概念。下面的描述都是基于离散数据的，连续型数据（需要积分运算）不在此范围内。

### 均值（Mean）

一个离散序列的算术平均数：

$$
\bar{\boldsymbol{x}} = \frac{1}{n}\sum\limits_{i=1}^n x_i \tag{1.5.1}
$$

比如一个数组 $\boldsymbol{x}=[1,2,3,4,5,6]$，其均值为 $(1+2+3+4+5+6)/6=3.5$。

### 数学期望（Mathematical Expectation）

对于离散的随机变量，其一切的可能的取值 $x_i$ 与对应的可能出现的概率 $p_i$ 的乘积之和就是该离散序列的数学期望。

$$
\mathbb{E}[\boldsymbol{x}] = \sum_{i=1}^n p_i x_i \tag{1.5.2}
$$

比如一个六面的骰子（1 到 6），掷出每个数字的概率都是 $\frac{1}{6}$，即 $p_i=\frac{1}{6}$，则：

$$
\mathbb{E}[x] = \frac{1}{6}\times 1+\frac{1}{6}\times 2+\frac{1}{6}\times 3+\frac{1}{6}\times 4+\frac{1}{6}\times 5+\frac{1}{6}\times 6=3.5
$$

如果是做了手脚的骰子，掷出 1 至 6 的概率分别为 $p=[0.1,0.1,0.1,0.3,0.4,0.0]$，则 $\mathbb{E}[x]=0.1 \times 1+0.1 \times 2+0.1 \times 3+0.3 \times 4+0.4 \times 5+0.0 \times 6=3.8$。

如果所有变量出现的概率 $p_i$ 相等的话，则数学期望就等于均值。

### 方差（Variance）

方差（variance）这一词语率先由英国统计学家罗纳德·费雪（Ronald Fisher，1890-1962）提出。

统计学中的方差（样本方差）是每个样本值与全体样本值的平均数之差的平方值的平均数，它描述了随机变量与均值的偏离程度，其数值越大，说明数据离散程度越高。

当变量总体数量已知为 $n$ 时，总体方差为：

$$
\begin{aligned}
\sigma^2 &=\frac{1}{n} \sum_{i=1}^n(x_i-\bar x)^2 \\
&=\frac{1}{n} \sum_{i=1}^n x_i^2 - (\frac{1}{n} \sum_{i=1}^n x_i)^2
\end{aligned}
\tag{1.5.3}    
$$

公式推导详见 1.5 小节。

当总体数量未知时，用抽取的样本数量 $m (m < n)$ 代替，经校正后，样本方差为：

$$
S^2=\frac{1}{m-1}\sum_{i=1}^m (x_i-\bar x)^2 \tag{1.5.4}
$$

在概率论分布中，随机离散变量的方差公式是：

$$
\begin{aligned}
var(x) &= \mathbb{E}[(x-\mathbb{E}[x])^2]
\\
&=\mathbb{E}[x^2]-E^2[x] 
\end{aligned}
\tag{1.5.5}
$$

公式推导详见 1.5 小节。

比如两个数据集合：$A=[0,8,12,20]，B=[8,9,11,12]$，其均值都是 10，但是二者的方差是：

$$
S^2(A) = [(0-10)^2+(8-10)^2+(12-10)^2+(20-10)^2]/3=69.33
\\
S^2(B) = [(8-10)^2+(9-10)^2+(11-10)^2+(12-10)^2]/3=3.33
$$

可以看到 A 的方差比 B 大很多，离散程度较高。

### 标准差（Standard Deviation）

标准差是方差的平方根。

根据公式1.5.3，有：

$$
\sigma = \sqrt{\frac{1}{n} \sum_{i=1}^n(x_i-\bar x)^2}
\tag{1.5.6}    
$$

或：

$$
S = \sqrt{\frac{1}{n-1} \sum_{i=1}^n(x_i-\bar x)^2}
\tag{1.5.7}    
$$

还使用上面的例子计算 A 和 B 的标准差S：
$$
S(A) = 8.3，S(B) = 1.8
$$

既然有了方差来描述变量与均值的偏离程度，那标准差有什么用呢？

方差与我们要处理的数据的量纲是不一致的，虽然能很好的描述数据与均值的偏离程度，但是处理结果是不符合我们的直观思维的。比如想比较不同机房的服务器数量的分布，方差计算出来的数值是“台数”的平方，而标准差就是“台数”。

### 协方差（Covariance）

在概率论和统计学中，协方差用于衡量两个变量的总体误差。而方差是协方差的一种特殊情况，即当两个变量是相同的情况。

期望值分别为 $\mathbb{E}[x]$ 与 $\mathbb{E}[y]$ 的两个实随机变量 $x$ 与 $y$ 之间的协方差 $cov(x,y)$ 定义为：

$$
\begin{aligned}
cov(x,y) &= \mathbb{E}[(x-E(x))(y-\mathbb{E}[y])]
\\
&=\mathbb{E}[xy]-\mathbb{E}[x]\mathbb{E}[y]
\end{aligned}
\tag{1.5.8}
$$

公式推导详见 1.5 小节。

比较公式 1.5.5 和 1.5.8，把后者中的 $x$ 换成 $y$，就变成了前者，可见方差是协方差的特殊形式。

对于离散变量，公式如下：

$$
\begin{aligned}
cov(x,y) &= \frac{1}{n} \sum_{i=1}^n (x_i -\bar x)(y_i - \bar y)    \\
&= \frac{1}{n}\sum_{i=1}^nx_iy_i - \frac{1}{n^2}\sum_{i=1}^nx_i \sum_{i=1}^ny_i
\end{aligned}

\tag{1.5.9}
$$

公式推导详见 1.5 小节。

样本协方差公式：

$$
cov(x,y) = \frac{1}{n-1} \sum_{i=1}^n (x_i -\bar x)(y_i - \bar y)    
\tag{1.5.10}
$$


### 偏差

假设图 1.2.1 中椭圆内的黑色样本圆点是针对一个机器学习问题中的所有可能的数据集 D，三个圆形区域内的样本是子数据集 Da、Db、Dc。

<img src="./images/1-5-1.png" />
<center>图 1.5.1 样本数据可视化</center>

如果我们能获得所有可能的数据集（这一般是做不到的，我们只能收集尽量多的数据样本），则可以训练出一个真实模型 Mr。用子数据集 Da 训练出来的模型 Ma，它的预测输出不可能超出左侧的圆形范围，那么这就会与真实模型造成偏差。同样，Mb 和 Mc 也会有偏差。

但是！请不要忘记，一般情况下我们不知道全部数据 D 和真实模型 Mr，所以只能用模型 Ma、Mb、Mc 互相比较来模拟。

假设某个样本 $x$ 的真实值为 $y$，模型 Ma、Mb、Mc 对样本 $x$ 的预测输出分别为 $y_a、y_b、y_c$，则期望预测为：

$$
\hat{y} = E[(y_a,y_b,y_c)]
$$

可以简单理解为 $\hat{y}$ 是 $y_a、y_b、y_c$ 的算数或几何平均，见图 1.5.1 右侧子图。那么偏差 bias 的定义是：

$$
bias^2(x) = (\hat{y}-y)^2 \tag{1.5.11}
$$

### 思考和练习

1. 用 Python 代码实现本小节中的公式，并于 1-5-SeveralConcepts.py 对照，运行并理解。
