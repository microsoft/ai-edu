
## 13.6 概要设计说明书

### 13.6.1 对一个标准模板的分析

以下模板是在众多概要设计模板中相对靠谱的一个，我们可以按照从 13.5 中得到的设计任务知识来审视这个模板，以便让领读者理解它到底要求我们开发人员做哪些事情。

下面的黑体字部分是原模板中的内容，【最佳实践】是笔者的建议。

#### 1. 引言

- **1.1 编写目的；1.2 项目背景；1.3 定义；1.4 参考资料。**

【最佳实践】

这一部分的 1.1 和 1.2 基本上就是套话，没有必要写；1.3 可以挪到后面写，主要是一些专有名词定义；1.4 一般情况下不用写，除非有一个重大的知识背景只有你知道，别人都不知道，但是对这个项目又特别关键，才应该在此强调。

#### 2. 任务概述

- **2.1 目标；2.2 运行环境；2.3 需求概述；2.4 条件与限制。**

【最佳实践】

2.1 是套话，不写；2.2 运行环境相当于**物理部署设计**，可以放到后面，但是在这里也可以当作条件和限制（需求的一部分）简单说一下；2.3 和 2.4 可以保留，做为需求应该放在前面，即**业务场景设计**。

#### 3. 总体设计

- **3.1 基本设计概念和处理流程；3.2 总体结构和模块外部设计；3.3 功能分配；3.4 功能需求和程序的关系；3.5 尚未解决的问题。**

【最佳实践】

3.1 有些模糊，不知道应该写什么；3.2 和 3.3 相当于**逻辑功能设计**；3.4 相当于**软件开发设计**，即模块和代码文件的对应关系；3.5 可以放到前面的任务概述中去。

#### 4. 接口设计

- **4.1 用户接口；4.2 外部接口；4.3 内部接口。**

【最佳实践】

4.1 用户接口应该在 designer 给出的界面与交互设计中单独提供，如果简单到只有一两个界面的话，也可以画在这里；4.2 是要描述系统内部的接口，因为前面有了模块，所以现在需要有模块间的交互，即接口；4.3 是系统对外访问或者被外部访问的接口。

但是在 13.5 节中，我们并没有提到过接口设计，这是为什么呢？因为接口是连接静态结构与动态行为之间的桥梁，在讨论**运行过程设计**之前就把接口提出来，在顺序上不容易理解。所以笔者认为可以把 6（运行设计）提到前面来，和 4 合并在一起。这样就和 13.5 中的六视图法完全一致。

但是，外部接口实际上是对系统设计的一种限制条件，尤其是访问外部已有系统时，由于接口已经存在，所以只能去被动适应。所以，可以改名为“外部限制”放在静态结构中。

#### 5. 数据结构设计

- **5.1 逻辑结构设计；5.2 物理结构设计；5.3 数据结构与程序的关系。**

【最佳实践】

5.1 和 5.2 即**数据存储设计**；5.3 应该属于**软件开发设计**。

#### 6. 运行设计

- **6.1 运行模块的组合；6.2 运行控制；6.3 运行时间。**

【最佳实践】

即**运行过程设计**，放到 4 中和接口设计一起提供。

#### 7. 出错处理设计

- **7.1 出错输出信息；7.2 出错处理对策。**

【最佳实践】 

这一部分的内容其实更应该写在《用户手册》里。

### 13.6.2 建议的《概要设计说明书》模板

下面的黑体字部分是本书建议的《概要设计说明书》的模板的标题，其它部分都是属于【最佳实践】性质的的说明性文字。读者在使用前需要删除这些说明性文字，然后填写与项目有关的内容。

在微软，通常把《概要设计说明书》称作 Dev Spec 或 Design Spec，因为这是 Developer 要完成的任务。如果软件规模大的话，通常由 Dev Manager 或 Dev Lead 来撰写，如果是一个局部功能，就由 IC（Individual Contributor，即开发人员）来撰写。很少要求写《详细设计说明书》，或者只要求写一个 One-Page Spec（简单的单页设计文档）。

概要设计说明书是概要设计阶段完成后的输出，需要撰写人员讲解、项目组成员集体评审后通过并执行。

#### 1. 概述（Overview）

**1.1 任务概述**

可以摘抄需求规格说明书（PM Spec）的主要内容，用于说明项目背景。

**1.2 术语解释（Terminology）**

对与设计领域相关的、或者程序内部模块或子系统命名的术语加以说明。

**1.3 目标和非目标（Goal/Non-Goal）**

列出本设计关注的目标，以及不属于本设计范畴之内的但是有关联的项目。比如：

- 目标：通过简化文件内容设计来提高文件到磁盘的存取速度。
- 非目标：对于标准格式的文件（如PDF）的简化不在此设计之内。

**1.4 尚未解决的问题（Open Issue）**

说明在概要设计过程中尚未解决、而设计者认为在系统完成之前必须解决的各个问题。可以是技术或其它方面的问题。比如：

- 如何处理过期的用户（如退休的教师和毕业的学生）的用户记录，目前还没有考虑。
- PDF 阅读与标记控件，在 Windows Form 或 XAML 应用程序中不能工作。
- 桥牌模型很有可能在 3 个月内无法训练出来，或者达不到预期要求的质量。

#### 2. 总体结构设计（Architecture）

**2.1 逻辑功能设计**

推荐的方式有：

- 分层设计
  
  分层，首先需要功能分类，相同类别的功能可以构成大模块或者子系统。最流行的三层结构，即表示层、业务逻辑层、数据访问层，可以普遍适用到所有软件架构中。因为在三层结构的框架上，最上层总是用户接口，最下层总是数据存储，当然如果你的软件是一个局部模块开发，就不需要三层结构，而是要简单的多，那么基本上也不用分层设计了。

- 模块/子系统设计

  各个软件系统不同的地方在于中间的业务逻辑层，可以有很多变化，比如：

  - 可以再细分成多层
  - 可以在同一层分割成很多模块
  - 可以是外部系统

  这里并不涉及模块内部的细节（属于详细设计范畴），只考虑外部轮廓。

这一部分要用框架图绘出，加文字描述。

**2.2 外部系统**

系统访问其它外部系统的出口，要预先规划好都需要访问哪些已有系统，限制条件是什么。

#### 3. 运行过程设计

**3.1 用户接口**

这是一个独立的文档，在第十章中有具体讲解。一般包含：

- 用户界面设计图
  
  业内成为 Redlines（红线图），因为红色很少用于界面元素中，所以用红线来做标记。

- 用户交互流程图
  
  用户在界面A上点击不同的按钮后，会跳到不同的新页面，从界面A的各个按钮上会引出一条条红线到其它界面。

由 Designer 完成，交给开发人员实现。

**3.2 运行模块组合**

说明对系统施加不同的外界运行控制时所引起的各种不同的运行模块组合，说明每种运行所历经的内部模块和支持软件。

如果流程复杂，可以用表格或文字的形式展现，避免绘制复杂的图形。如果绘图，可用流程图、时序图等。

**3.3 进程/线程**

进程、线程的实现存在于代码中，但是如果不运行起来，非常难以识别。即使运行起来，人们也是无法“看到”其运行过程。

进程、线程设计包括：

- 名称
- 作用
- 生命周期（启动、停止条件）
- 实现机制（进程、线程、服务，或者是 Azure 上提供的一些其它计算服务）
- 运行物理环境（架构设计中的哪个服务器或者子系统）

这一部分用文字描述即可，放在表格内。

**3.4 内部接口**

内部接口，一般包含以下几种形式：

- 对象方法调用或函数调用
- 进程间通信（管道或者套接字）
- RESTful API
- 消息队列

内部接口众多，只描述大模块之间的接口即可。可以用两种图来表示：分层关系接口图，组件交互时序图。

**3.5 外部接口**

被外部系统访问的入口，一般是 HTTP 形式或 RESTful API。

#### 4. 数据存储设计

数据设计，一般是指对永久存储的数据的设计，包含数据库和数据文件两类。

**4.1 数据库设计**

一般是指关系式数据库。主要涉及的内容包括：

- 表
- 主键、外键、索引
- 存储过程

**4.2 数据文件设计**

一般是从类的属性做序列化得到数据文件，可能包括的数据文件类型有：

- 二进制
- 纯文本
- XML 扩展标记语言
- JSON 对象标记语言

如果是后两者，则格式中自带信息描述，就不用写设计文档了。如果是二进制文件，必须按字节描述文件格式。如果是纯文本格式，一般是按行分开记录，即 \r\n，使用 \tab 或逗号分割字段。

**4.3 数据结构/接口设计**

传统教材并不包含此类别的数据设计要求。

由于计算机软硬件技术的发展，有很多类型的数据是内存或网络中的临时运行用数据，比如：

- 栈
- 堆
- 数据包
- 消息队列

消息队列组件，队列中的数据平时是在内存中的，为了怕丢失任务，所以组件把内存中的数据也存储在了磁盘上。

这类数据如果是绑定在数据发送或接收方的对象上（作为属性），则可以在类设计（属于详细设计范畴）里包含。如果是比较独立的，既不从属于数据发送方，也不从属于数据接收方，则需要单独在这里设计。

#### 5. 软件开发设计

用一张表说明，各项需求的实现同各程序模块的分配关系。

如果还有其它关于开发步骤、流程的说明，可以记录在这里。

#### 6. 运行环境设计

描述软件分发/上线后的运行环境：

- 软件运行环境
  
  如 iOS 或 Android 智能手机系统、Windows 系统（台式机、HoloLens、Xbox、Surface Hub）、Linux 或 Mac 系统等。

- 硬件运行环境
  
  比如：智能手机、独立计算机、服务器、虚拟机、云端服务等，应包含对内存、硬盘、网络的要求。


- 网络系统设计

  如果是分布式的系统，或者是涉及到多方通信的系统，包括对外部系统的依赖，都需要加入网络系统设计。包含：
  - 选择操作系统
  - 确定网络系统配置
  - 制定网络拓扑结构


#### 7. 发布与维护设计

**7.1 日志（Telemetry）**

这个工作其实应该是 PM 的工作，定义哪一个用户行为需要记录日志，比如：

- 打开应用
- 点击按钮
- 打开某个网页
- 收藏了某个网页
- 关闭应用

这些日志会最终发送到服务器上，作为用户行为分析的数据源。

**7.2 试验（Flighting）**

这是对已经上线的系统的增量更新。

1. 事先在系统中实现一个功能 A；
2. 如果你的系统是一个基于浏览器的服务，那么在服务器上可以随机地让某些用户看到功能 A 并使用，另外一些用户看不到；
3. 如果是基于手机的 App 应用，应用商店会有这种“只给10%的用户提供试验性功能下载”的功能，其它用户收不到新 App 下载通知。


**7.3 计划与安排（Timeline/Work Item）**

根据项目大小，有可能是多人合作完成，或者是单人独立完成：

- 多人合作：列出分工及计划，如表13-9：

  表 13-9 工作计划与分工

  |人员|工作|初步计划|
  |--|--|--|
  |木头|管理子系统|3周|
  |石头|推理子系统|4周|
  |肖哥|训练子系统|5周|
  |毛毛|存储接口模块|2周|

- 单人完成：列出模块划分、完成时间，如表 13-10。

  表 13-10 模块计划

  |模块名称|初步计划|
  |--|--|
  |Azure Blob 数据读写模块|2天|
  |Flask Restful 服务|10天|
  |发送邮件模块|3天|
  |开关 Azure 虚拟机模块|5天|

**7.4 中止机制（Exit Criteria）**

遇到何种情况时，即停止开发工作、放弃项目。

如：

- 甲方公司使用的网络环境发生变化，导致前期的开发工作浪费。
- Windows 10 下一个发布计划中不再支持对浏览器的内置支持，所以依赖其开发的浏览器项目应该停止。

