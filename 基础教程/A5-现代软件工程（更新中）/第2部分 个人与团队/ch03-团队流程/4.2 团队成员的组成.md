## 4.2 团队中的故事

前一段时间木头接手了一个项目：某金融公司与 MSRA 的机器学习组的研究员合作量化交易的研究。木头的任务是在 Azure 上开发一个系统，把数据上传、训练、推理、模型管理等组织起来并部署到 Azure 上，方便客户、研究员、管理者使用。

### 4.2.1 团队项目成员角色

- 研究员、研究员 Lead、研究员 Manager
- 实习生、工程师、工程师 Lead、工程师 Manager
- PM、PM Manager
- 微软方市场人员及商务管理人员
- 客户方技术人员和市场人员

参与具体的技术开发项目的成员是：

- 研究员“大肖”
- 工程师“木头”
- 工程师“石头”
- 实习生 x 2
- 技术指导（Tech Lead）“大齐”
- PM “小P”

因为是闹疫情，所以我们每周一次的例会都是通过 Microsoft Teams 软件在线上开的。木头负责系统设计和技术文档，当然也要写代码和测试，所以每次都是木头发出最新的技术文档供大家评审。评审反馈可以通过邮件，也可以在线会议时口头给出。

下面的故事中列出了几个小的讨论细节，便于大家了解真实的团队合作过程。

### 4.2.2 需求讨论

经过一周多的需求调研，木头列出了四个子系统的 Use Case（用例）：

- 用户界面子系统
- 模型推理子系统
- 模型训练子系统
- 模型管理子系统

1. 石头同学给了5条反馈，其中第2条反馈是：“应该设计一个训练ID，用于连接上下文的唯一ID。”

    *注：这个意见很重要，虽然不是需求阶段应该讨论的问题，但是说明石头同学已经开始思考实现细节了。*

2. 大齐同学给了一条反馈：“我比较倾向把推理子系统，合并进模型管理系统，作为一个子模块，因为他们的依赖性太强了。而且它很难独立开发或单独使用，尤其是模型历史和上下文信息都是由管理系统处理的。”

    *注：这个讨论的范畴是对的，针对需求用例阶段。但是木头不同意这个结论，不管依赖性有多强，这都是两个子系统，不应该合并。*

3. 小P 给的反馈是：“模型训练和选择是研究员的工作，工程师这边只负责制定接口。”

    *注：这也是对的，因为木头一开始就陷入了对训练和推理细节的学习和探讨，但后来发现重点不对，意识到这两个是独立子系统，是研究员负责的，只需要把它们当作黑盒子调用即可。果然得到 PM 的认可。*

经过这一轮的讨论，团队内部确定了系统架构和职责划分。

### 4.2.3 技术选型

这个系统中的技术点很多，每个点都有多种选择，需要团队讨论。木头印象较深的是推理机制触发的问题。

在以前的试验室系统中（利用熟悉的技术搭建的简单系统，可以工作但并不方便），客户上传完数据后，要通过微信通知研究员来启动推理系统工作。木头试图把它变成自动化的流程，即客户上传完数据后可以自动触发推理动作。两种方案：

- 在服务器端，检测 Azure Blob（云数据存储）上的文件变化，一旦有新数据上传，就启动推理；
- 在客户端，把原有的简单的 SFTP（安全文件传输协议）客户端改成有一定智能的脚本，上传完数据后，利用可执行程序给服务器发信号来启动推理。

经过团队好几轮的线上讨论，得到大家的反馈：

- 研究员认为可以减轻工作量，使得流程自动化，很好；
- 石头认为这是体现工程师设计水平的技术环节，很好；
- PM 认为这是改善服务质量的环节，很好。

只有 Tech Lead 的顾虑较多，他认为：

1. 如果有可能尽量不 release 任何 binary 给用户，因为这会增加我方法律或安全上的风险。如果之后 scenario 上有变化，修改 server 上的程序也会比修改客户端简单，及时的多。

2. 完整性检查是必需的步骤，不管用户用什么工具上传。服务器端都应该重新检查一下, 因为我们最后还是要对结果负责。如果用户上传了不完整或过期的数据，给用户对应的错误提示，这样应该更加友好一些。

木头回复：

1. 我同意“修改 server 端的逻辑易行”这个 statement 是正确的，我的考虑是：
    - 即使服务器端有代码逻辑，我们也不能确定“用户上传数据的完整性”，除非有口头上的约定，我们根据这个约定来写代码；
    - 如果服务器端不需要关于数据完整性判断的代码逻辑，则是最理想的状态，这种情况下完整性由客户负责。

2. 如果告诉用户一些常用的 binary 程序的链接，由他们自己下载使用，那也不算是我们 release 给用户的，比如 AzCopy.exe 和 Curl.exe。而我们就要利用这些已有的 binary 来做系统集成。

*注：客观情况是，用户有可能本周只传了2天的数据，也可能传了5天的数据，这要根据股票工作日情况而定，我们不可能把这个逻辑也放在数据检查中。任何数据完整性检查都不能应对所有可能的异常情况，那我们只能让客户来保证数据完整性。*

PM 也同意木头的意见。结果是，当客户听说可以自动化流程时，非常感兴趣，表示支持这个技术选型，下载使用那些 binary 文件也没有问题。

### 4.2.4 原型开发和产品开发

实际上原型开发就是为了验证技术选型。木头把整个系统的关键技术点分解出来，让大家认领，然后分别去验证。两个实习生被直接指派任务，去自己写代码做试验，然后回来汇报。实习生当然有权力发表自己的看法，但是面对复杂工程问题的时候，他们的实际经验并不多。

由于受疫情影响，实习生都是远程（在家）实习，每周汇报，所以木头并不能掌握他们的实际工作量是否饱满。果不其然，发现了其中一个实习生的问题：对 Azure 技术不太感兴趣，进展缓慢，但同时却参加了很多其他的学术/社会活动，没有专心在实习上。于是木头劝退了这名实习生，当然还会根据以前的表现考虑给与前半段的实习证明。

### 4.2.5 系统切换

一旦新系统上线，就有与旧的试验室系统并行或切换的问题。工程师石头负责旧的推理系统升级，以适应新的应用框架。

- Lead 认为：应该在新框架下跑一下旧的推理系统，以便平稳过渡；
- PM 也不懂技术，只是单纯地觉得过渡越平稳越好；
- 木头不置可否，因为不是木头的责任范围，没有发言权；
- 石头只是在在线会议里“嗯”了一声。

过了几天，那个 Lead 被调到别的项目里去了，不再参加我们的团队讨论。当我问石头“旧的推理过程是否已经跑通”时，石头说“那只是 Lead 的意见而已，我并没有打算修改旧的推理过程使之适应新框架，而是直接写新的推理代码，因为跑通旧的推理过程对新系统帮助不大”。


# 故事分析

猪和鸡的故事，想必大家不会陌生，中文有很多版本，也有英文的版本$^{[1]}$，只不过大家讲故事的场景不一样。笔者认为这个故事在团队建设中有很重要的指导作用，所以在本章中再次拿出来与大家分享。

## 猪和鸡的故事版本2.0

猪、鸡、狐狸、老虎、鹦鹉合伙开了一个饭店，具体分工是：

|动物|角色|工作内容|参与程度|失败后果|
|---|---|---|---|---|
|猪|员工|提供猪肉（从自己身上取）|全身心投入|血本无归|
|鸡|员工|提供鸡蛋（自己下蛋）|部分身心投入|损失不大，还可以在别的地方下蛋|
|狐狸|经理|提供执行建议并监控|智慧投入|学习到了失败经验，换个地方做经理|
|老虎|董事长|提供资金|钱财投入|损失一些金钱，九“虎”一毛|
|鹦鹉|局外人|提供咨询|围观|成败与自身利益无关|

以下内容摘自《构建之法》$^{[2]}$：

---
*加入一个团队时要弄清楚自己在团队中投入的级别是什么，别人的期望值是什么。人可以在$n$个地方做鸡，或者$n \times m$个地方做鹦鹉，但不可能在两个地方同时做猪，这太难了。在遵循敏捷原则的团队里，成员们并不忌讳谈论不同的投入和负责程度 -- 因为这就是现实。*

*但是他们一般有一个原则: 重大决定由 “猪” 来定夺。*

*我们初入公司，公司肯定希望我们都是猪这类的，全身心投入到项目中去。我们的任务也就是做好“猪”的角色。*

---

## RASCI 模型

RASCI模型明确了团队中的各个角色及其相关责任。笔者认为在任何一个团队中都会有这样的分工，可以和动物饭店以及上一节的木头的团队故事中的人物做类比（这里丝毫没有人格褒贬，只是一个角色上的类比）。

|名称|角色|动物类比|人物类比|人数|
|--|--|--|--|--|
|R - Responsible|负责，具体执行|猪|研究员、工程师|3|
|A - Accountable|管理，掌管全局|老虎|各个 Manager|3|
|S - Support|支持，配合工作|鸡|PM 和实习生|3|
|C - Consulted|顾问，决策支持|狐狸|Lead 技术指导|1|
|I - Informed|知情，参考指导|鹦鹉|市场和商务人员|2|


## 微软团队工作故事分析

有了以上的动物故事和 RASCI 模型做基础，我们可以对木头在团队中的故事做出清晰的分析。

我们先简单看一下人数问题。从表中可得，实际工作的有6人（3名研究员、工程师，1名PM，2名实习生），其它6人属于管理团队。而实际写代码的人只有3人，即研究员和工程师，其它3人属于支持、指导人员。

这样看起来，是不是微软的组织管理太过冗余了呢？我们看看下面的分析就知道了。

### 研究员和工程师

工程项目实施的主力，解决软件工程中所有的技术问题。在一段时期内（比如半年或两年），他们的主要时间都会花在这个项目上。质量好，速度快，下一年得到升职的机会就比较大。

### 管理者

其实大家可以看到，在故事中各个管理者并没有参与技术讨论，实际上他们掌管的项目很多，没有时间精力参与到某个项目的细节讨论中来，只是在项目启动的时候定个方向，给成员们打打气。

在微软，这是司空见惯的，一线管理者不会参与到细节讨论。在一些小公司，有可能管理者直接参与到细节讨论，这也可能是因为中层力量薄弱，或者层级较少。

### PM 和实习生

这两个角色是对团队的支持，很重要。PM做项目管理，与客户沟通，与公司内其它组织沟通等等。实习生在 Mentor（导师）的指导下，做一些被分解成单元的小任务，按照微软实习生的衡量标准，应该是可以完成的。但是实习生能不能写 Production（生产、上线）的代码，就不一定了，一般是导师把实习生的代码按照标准“包装”成生产代码。

### Lead 技术指导

实际上这个角色在微软不常见，大家可以看到 Lead 只是提出意见，并没有动手写代码。在这个项目中，Lead 确实提出了很多自己的见解，有些是有用的，可以帮助提高产品质量的；但有些却是节外生枝的考虑，让每个环节的决策都特别困难，增加了工程师的工作负担。

但如上所述，最终的重大决定权在“猪”，工程师可以参考 Lead 的意见，但是不一定采纳，只要拿出理由来即可。

### 市场和商务人员

他们在开始接触联系客户，签订合同，到后期执行时，不需要提出意见，除非是客户需求与合同不符。但是项目的任何进展都应该让他们知道，当他们有意见时，通常会直接给予管理团队，而不是给与工作团队。


