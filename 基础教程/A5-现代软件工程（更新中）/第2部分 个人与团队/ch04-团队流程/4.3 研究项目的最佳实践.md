## 4.3 团队流程的故事

下面是木头曾参与过的几个项目的故事。


### 4.3.1 项目 A - 多智能体强化学习平台

MARO - Multi-Agent Resource Optimizaiton 多智能体资源优化平台

<img src="Images/Slide6.JPG"/>

图 4.3.1 多智能体强化学习平台架构图

#### 项目规模

这本来是一个中型的项目：一个 dev manager，一个 tech lead，六个 dev，两个研究员，没有 PM 和 Designer。后来退化成一个微型项目，只有两个 dev。

#### 项目背景

一个跨国海运公司在世界各地的港口都有空的集装箱，需要及时地转运到所需要的港口装载货物。如果用传统的优化算法，每次计算需要花费好几天的时间，而且还不能克服一些临时的因素造成的误差，造成空集装箱没有正确地达到需要的港口。

所以研究员们用多智能体强化学习算法，成功地解决了这个问题。

#### 要解决的问题

和这个海运公司的合同结束后，研究员和工程师们想把这个算法发展成为多智能体强化学习平台，以便可以方便地解决类似问题。为此，建立了一个开源项目：MARO（Multi Agent Reinforcement Learning）

但是只有海运这样一个实例的话，是无法泛化的，于是研究员和工程师们又找了共享单车搬运、虚拟机管理、仓储库存管理等几个例子。



#### 关于例会

木头是在这个平台开发了一年后后才加入的这个项目。一进来就发现 tech lead 定的例会是每周一、三、五，这就很尴尬：因为周五以后就是周末，如果每个 dev 想在周一的例会上说出点儿什么来，就必须在周末花时间做出进展来。大家轮一圈儿后大概要花 30 分钟，而且那个 tech lead 特能说，每次都讲很多。除此之外，在例会之外他还会时不常地单独和每个 dev 联系，一讨论就是一个小时，语气很强硬。

那个 tech lead 很快就离职了，木头接替了他的职责，第一件事就是把以前的例会取消，然后重新建立了每周二、四两天的例会，每次例会大概 15 分钟左右。

#### 开发资源调整


这位 tech lead 把摊子铺得很大，所以每天都很忙的样子。他和研究员的关系比较密切，对研究员是言听计从。他在离职和木头的交接期间，有个研究员跳了出来主持例会，给各个 dev 安排任务，还给木头安排了一个文档任务，木头只是不置可否地笑了笑。木头和老板汇报了这件事，老板觉得是不可接受的：“我们虽然开放合作，但是还没有开放到可以让别的组的人来指挥我们的 dev 工作。” 

于是，木头就接管了这个项目。其实这是个烂摊子，没有明确的用户，只是在 GitHub 上开源了一个项目，还弄了一大堆人，没有可以产品化的产出，没有明确的计划，相当于是一个工程团队在搞研究。

木头和领导建议，把部分人力调配到了量化交易的项目上，这边只留三个 dev，继续支持研究员关于仓储管理的项目研发，但实际该仓储管理项目也没有明确的用户。

两个月后，领导和木头说，把这个项目交给 3.4 节中的女生 J，木头很痛快地答应了，但是每周的两次 sync 还是一起开。木头发现女生 J 作为 tech lead，她自己很少写 code，只做 code review。

#### 项目特点

- 没有明确的用户需求，所有需求都是研究员和工程师们自己想的。
- 没有用户声称他们自己使用了这个平台，部分原因是强化学习对于大多数人来说还很陌生。
- 老板们对这个项目也没有什么预期。

#### 最终结果

这个项目开源三年多了，至今还在有人维护，处于半死不活的状态，在 GitHub 上只有 660+ 颗星。


#### 项目 A - 多智能体强化学习平台

闭门造车，画饼充饥。

从需求上看：

这是存在于微软的研究员群体的一个通病。在完成了一个研究项目并有了实际的成果转换后，大家都想复制这种成功，于是想把“项目”变成“产品”，把“产品”变成“平台”，把“平台”变成“服务”。这种试图“泛化”的努力是违背了软件项目的基本规律的：还没有找到规律，就想建立模型。

基于统计的机器学习，和基于特征的深度学习，都已经被广泛地接受并落地于实际应用场景中。虽然强化学习的应用范围也很广，但是这方面的领域专家太少了。一方面，我们的研究员没有领域知识，不知道强化学习应该用在哪里；另一方面，有领域知识的人没有强化学习知识，而是寻求传统的求解思路，或者把目光转向机器学习和深度学习技术上，强化学习的入门门槛很高。所以，很多人对强化学习的了解还仅限于 Alpha Go 上。

从团队流程上看：

- 没有实际需求却放很多资源在上面，就是一种浪费。
- Tech lead 没有 design doc，不写 code，只做 code review，这是不对的。
- 实际上是由研究员指定的软件开发相关的工作内容，在软件工程上是一个笑话：如果研究员都能做软件工程的话，那还要我们这帮工程师干什么？
- 其实最关键的还是团队的老板，看不清这个项目的未来发展，即不懂技术又不懂管理，被人家画了个饼，却始终吃不到嘴里。

这个项目的先天缺陷太多，流程上也有问题。但即使流程再正确，也不能使得这个项目成功。

### 4.3.2 项目 B - 量化交易

Qlib - Quantitative Library

<img src="Images/Slide8.JPG"/>

#### 项目规模

这是一个中小型的项目，一个 Dev manager，一个 Tech lead，五个 dev，两个研究员，一个 PM，一个商务人员，一个外部的长期合作的客户（某基金公司）。

#### 项目背景

MSRA 的研究员们研究股票的量化交易很多年了，并建立了一个开源项目：Qlib。可是缺少实盘的机会。某基金公司听说以后，决定和 MSRA 合作，基金公司提供数据，由研究员们提供算法、模型、预测结果，基金公司参考预测结果再结合以往的投资经验来操盘。

#### 要解决的问题

每个交易日，基金公司都要手工上传昨天的交易数据，用微信叫醒熟睡的研究员，研究员去下载交易数据，处理后用模型做预测，然后微信通知基金公司取结果。整个过程基本没有自动化。

每过 60 个交易日，基金公司就要求研究员使用最近的历史数据重新训练模型，在历史数据上比较新旧模型的差异，然后切换模型。这个过程也都是手工完成，很繁复。

木头的任务就是把上述过程工程化、自动化，省去手工操作的麻烦和误操作。


#### 关于例会

- 每周二、四，木头会安排组内会议，大家 sync 一下当前进度。

- 每周五收盘后，和客户开一次例会，由研究员分享最新的研究成果。开会时客户那边一般是两三个人，我们这边三个工程师、两个研究员、两个商务人员、一个 PM 都要参加。

- 每两周，开发团队要和研究员们做一次内部例会，工程师们汇报系统设计及开发的进展。

#### 开发流程

- 木头作为 Tech lead 负责开发团队，安排一个 dev 做推理预测部分的工程化，两个 dev 接手改造陈年失修的数据处理 pipeline，两个 dev 做训练部分的工程化。

- 在正式开始之前，木头先把任务做了粗粒度的分割，估算每个部分所需开发时长，并用此时间来对内对外宣布，一是给内部人员一个紧迫感，二是给外部人员一个预期。

- 木头自己画了很多图，并配以较少的文字，来说明整个系统的架构，一是用于对内统一思想，一是用于对外汇报。

- 每次做一个新模块，木头会要求相关人员写一个简单的设计。因为木头发现，某些 dev 很快就能做出一个功能模块来，但是在 sync 时发现设计太复杂，不利于后续人员的理解和后期维护。

- 所有工作都在 Microsoft Azure 上进行，因为客户买了 Azure 的订阅。

#### 项目特点

- 用户的需求很模糊，只是要求快、准、自动化。

- 用户只有一家。

- 因为涉及到上亿的投资规模，所以用户很谨慎并且苛刻，每上一个新功能都要严格把关，要求我们能够做到自验证。

- 甲方强势，乙方必然弱势。微软这边投入了大量的人力，但是合同金额并不大，只是为了能够把研究成果市场化。

- 工程师作为辅助角色，没有很多的话语权。

#### 最终结果

大家用了四个月的时间，终于把所有的训练系统、推理系统、模型管理系统做到了自动化，客户很满意。

还有一点：自动化训练系统使用多 GPU 机器并行完成，在工程化过程中经过了多轮的测试以验证其稳定性，结果用爆了用户的订阅额（quota），促使用户在下一期合同的时候购买了翻倍的订阅额。



#### 项目 C - 量化交易

婆婆妈妈，盘根错节。扭曲

Qlib - Quantitative Library，命名为一个 Library，意为用户只要调用 API 就可以完成指定的任务。但实际上，它是一个 Framework。也就是说：用户必须按照 Qlib 所规定的流程

从需求上看：

toB
toC



需求肯定有，但是这种项目有个致命的问题：不能推广。比如，客户 A 已经使用了我们的量化交易系统，我们又找到了客户 B，人家会问：有别的客户使用你们的系统吗？如果你说“还没有”，那客户 B 会觉得不放心；如果你说“已经有了”，那客户 B 会质疑：如果我们也使用，那么和客户 A 的算法就是完全一致的，在股票市场上就会造成严重的买卖同质性。

从团队流程上看：

- 每周两次的内部 sync 是必要的，这是项目流程的基本需要。
- 每周一次的和客户交流也是未尝不可的，但是没必要这么频繁。
- 每两周一次的内部交流，纯属是工程师对研究员的单方向汇报，笔者认为跑偏了，相当于工程师是研究员的下属，而不是合作关系。如果是双方互相交流的话，那就是另外一番场景了。
- 从与客户的关系看，由于以前研究员们对客户过于“卑躬屈膝”了，真的把客户当成“上帝”了，搞得 PM 根本拦不住也不敢拦客户的随机要求。

所以，这个项目虽然从流程上看是大体合格的，并且最后是成功的，但是不该牵涉到的东西太多，木头感觉很累。
