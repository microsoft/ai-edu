
## 4.8 大中型系统的最佳实践


### 4.3.4 项目 D - ONNX Converter

<img src="Images/Slide9.JPG"/>

#### 项目规模

这一次的项目个大家伙：ONNX 其实是一个产品，整体大概有 200 多人。木头参与的是其中一个子项目 ONNX Converter，算是中等项目吧。一个 dev manager，没有 tech lead，10 几个 dev，而且分布在美国、法国、中国等四个办公地点。

#### 项目背景

ONNX（Open Neural Network Exchange）开源项目，开放的神经网络模型交换格式。作为框架共用的一种模型交换格式，使用 protobuf 二进制格式来序列化模型，可以提供更好的传输性能我们可能会在某一任务中将 Pytorch 或者 TensorFlow 模型转化为 ONNX 模型(ONNX 模型一般用于中间部署阶段)，然后再拿转化后的 ONNX 模型进而转化为我们使用不同框架部署需要的类型，ONNX 相当于一个翻译的作用。

另外，在微软，所有训练出来的模型，最后都会用 ONNX 格式做线上推理。

#### 要解决的问题

用户使用各种深度学习框架搭建的模型，互相之间不能互相转换，而且各个框架着重于训练，而在推理方面则速度较慢。ONNX 作为模型推理平台，可以提升速度，简化环境部署依赖。

木头负责其中的 Scikit-Learn 模型到 ONNX 模型的 converter 的维护，也接触了 PyTorch 模型到 ONNX 模型的 converter。还有人负责 TensorFlow 模型到 ONNX 的 converter。主要框架早已经搭建好了，但是在用户使用过程中会发现不少 bug，以 GitHub issue 的形式记录下来，大家认领属于自己领域的 bug 去修复，而这些 bug 绝大多数是前面的开发者遗留下来的。

<img src="Images/Slide7.JPG"/>

#### 关于例会

Dev manager 在美国，每周一下午（中国时间是周二早晨）开例会，有美国人（分布在东部和西部两个时区）、印度人、中国人、法国人，大家用英语，每个人简单说一下自己在干什么，而且要有 GitHub issue 或者 PR 的 link 来证明。

#### 开发流程

- 每半年会重新调整一下工作重点。

- 在这半年中，至少会有 2 次 milestone（里程碑），用于把积累的功能发布为新版本。

- 每周写一次汇报，内容是：上周做了什么，遇到什么困难，本周打算做什么。

- 除了 dev 自己找任务外，Dev manager 也会根据每个人的 workload 分配一些任务。

- 每周例会时，先是很快地 sync 完进度，然后会有一个人（轮班制）讲他是如何解决一个问题的经历，供大家学习参考。

- 代码评审都是找与自己同时区的 dev 来做，避免跨洋交流。至少有一个人做了 code review 并 approve 后才能 check in 代码。

- 有已经搭建好的 CI Pipeline，里面有大量的 UnitTest，每次 check in 代码必须经过 pipeline 的检验，所有 test case 都通过了才能继续。

#### 项目特点

- 这是一个维护型项目，框架已经定型，主要的任务是解决 bug，提高 user experience。
- 人员分布比较散，没有明确的进度要求，工作全靠自觉。

#### 最终结果

直到现在这个项目还在处于维护阶段，解决了用户的大量典型问题，让 ONNX 更好用。




#### 项目 D - ONNX Converter

按部就班，稳步前进。

从需求上看：

这个需求也是需要一种战略性的眼光才能发现的，弥补了微软在 AI Framework 方面的缺憾。

瀑布式

从团队流程上看：

- 半年一次方向性调整是对的。
- 每周一次的 sync 频率也是对的。

- 团队分布

这种体量和性质的项目，不能像项目 B 那样频繁操作，所以团队流程是正确的。
