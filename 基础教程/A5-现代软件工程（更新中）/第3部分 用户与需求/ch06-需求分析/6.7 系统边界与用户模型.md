# 6.7 系统边界与用户模型

这是做技术需求分析的第一步，在这一步中，我们要建立“用户模型视图”。我们使用 6.3 节中的 AI 教学需求来作为例子进行分析，步骤如下：

<div align="center">
<img src="Images/Slide26.JPG"/>

图 6.7.1 - 用户模型的建立方法
</div>

1. 这个视图从用户（在UML中叫做参与者）角度来审视系统，通过上下文图来确定系统边界，我们可以用一个“空的鸡蛋筐”来比喻这个系统。

2. 使用用例图来建立模型，每个用例好比一个鸡蛋，在这一阶段我们不需要探查鸡蛋内部的构造，只需要把所有鸡蛋都放进筐里即可。

3. 有紧密联系的用例可以组织在一起形成子系统，有可能的话，我们尽量把这些子系统也发掘出来，并规划它们的边界。这就好比一堆红皮（含有卵壳卟啉）鸡蛋要和另外一堆白皮鸡蛋分开。

4. 对于复杂的用例，可以进一步细化，定义一些子用例。这就好比鸡蛋堆里混进来一枚大鹅蛋，一口吃不掉，需要拆成几份鸡蛋大小的部分。

5. 用例说明可以帮助后续的人员深入理解，避免理解偏差。相当于给每个鸡蛋注明要做什么菜品和口味。

## 6.7.1 系统上下文图（Context Diagram）

上下文图是需求分析的第一站，用于确定系统的边界，这对于整个系统的目标/非目标（Go/Non Goal）是非常关键的。

### 正确的上下文图

我们先看第一张图：

<div align="center">
<img src="Images/Slide27.JPG"/>

图 6.7.2 - 上下文图
</div>

图6.7.2中有三种图例：

1. 待建系统本身

   中心位置是“AI教学系统”，我们把它看成黑盒子，因为在这个阶段，我们还没有对其进行分析，所以得不到细节。

2. 外部合作者
   
   包括两类：
   - 用户：人机交互。
   - IT 系统：使用计算机网络协议传递消息。

3. 数据/信息流

   有以下几个特点：
   
   - 信息流是双向的；
   - 都是名词，表示信息或者数据；也可以使用动词短语，比如“发送登录请求”，但要求所有信息流的文字是相同的形式，全是名词或者全是动词短语；
   - 可以是协议，也可以是数据格式；
   - 特定规范，如安全性、可用性、吞吐量等。
   
   这些信息将成为设计外部数据接口的依据。当然，在此图中，我们并没有写出所有的信息流，比如：

   - 学生可以提交作业，然后获得作业评分；
   - 老师可以发起命令保存手写板书，然后以邮件形式发送给学生；
   - 管理员可以开启/关闭教学系统。

### 错误的上下文图

我们再看第二张图：

<div align="center">
<img src="Images/Slide28.JPG"/>

图 6.7.3 - 错误的上下文图
</div>

根据前面讲述的关于系统上下文图的绘制规则，我们可以看到这张图中存在以下错误：

1. AI教学系统不是黑盒子，多画了两个内部的子系统；
2. 在学生与学生管理系统之间，不应该有那条虚线表示的联系，因为那不属于待建系统的范畴；
3. 在右侧弧形虚线之外，还有一些其它的用例，也不属于待建系统的范畴。

### 小结

系统上下文图是软件需求分析中的一项很重要的内容，属于DFD（Data Flow Diagram，数据流图）中的最高层次的图，是系统功能的最高抽象。系统上下文图将整个系统看做是一个过程，这个过程实现系统的所有功能。所以上下文图中存在且仅存在一个过程，表示整个系统。

将整个系统功能抽象为单一过程之后，系统本身就变成了一个黑盒，此时只有依据系统与外界的所有交互才能准确界定系统的功能。所以，系统上下文图中需要表示出所有和系统有交互的外部实体，并描述交互的数据流，包括系统输入和输出。

## 6.7.2 用例图（Use Case）

获得了系统上下文后，我们应该进一步进入待建系统进行分析，这就需要用例图。用例图主要用来描述“用户、需求、系统功能单元”之间的关系。它展示了一个外部用户能够观察到的系统功能模型图。

### 简单的例子

<div align="center">
<img src="Images/Slide29.JPG"/>

图 6.7.4 - 系统与子系统用例
</div>

上图中，左侧是一个顶层的用例，表示在 AI 教学系统包含有两个顶层用例：
- 作业子系统
- 实验子系统

当然还会包含其它子系统，我们只用这两个子系统举例说明。

在右侧的图中，深入到作业子系统中，可以看到需要至少4个用例来支持：

- 浏览作业
- 提交作业
- 获得评分
- 获得提升

在上面的图中，一共有四种图例：

1. Actor（参与者），用人形表示，在这里是“学生”。它描述与系统交互的人或物，代表外部实体（如用户，硬件、设备等）；
2. 系统或者子系统边界，用矩形框表示。这里是AI教学系统和作业子系统；
3. 用例，包括子系统用例（作业子系统、实验子系统）和功能用例（浏览作业、提交作业、获得评分、获得提示）。它是执行者与计算机一次典型交互，代表系统某一完整功能。
4. 关联线，表示参与者与用例的交互关系。注意这是一条直线，没有箭头，在旧的版本的UML中是一条指向用例的三角箭头线。

如何发现参与者：

- 谁使用该系统；
- 谁改变系统的数据；
- 谁从系统取信息；
- 谁需要系统的支持以完成日常任务；
- 谁负责维护管理并保持系统正常运行；
- 系统需要应付那些硬件设备；
- 系统需要和哪些外部系统交互；
- 谁对系统运行产生的结果感兴趣。

如何发现用例：

- 参与者需要获取何种功能，需要做什么；
- 参与者需要读取产生、删除、修改或存储；
- 系统发生时间和执行者间是否要通信。


### 复杂的例子

<div align="center">
<img src="Images/Slide30.JPG"/>

图 6.7.5 - 特殊关系的用例
</div>

1. 包含（include）关系

左图中，用“提交作业”作为基用例，首先，它“包含”了两个底层用例：

- 下载作业：做作业之前，先要把作业下载下来，包括描述、数据、模型等等；
- 保存作业：作业做了一半，还没到提交的地步，可以先保存起来，留着明天做。

这里用的是“包含”的关系，从基用例指向被包含用例，虚线短箭头，即一个基本用例包含另一个用例行为（要实现基本用例必须满足另一个用例行为）。

2. 泛化（Generalization）关系

其次，提交作业还有可能只是一个抽象的概念，它实际上可以“泛化”为两个实际的用例：
- 提交课堂训练结果作业
- 提交课后复习作业

这里用的是“泛化”的关系，从子用例指向基用例，实线三角箭头，是“一般情况”与“特殊情况”的关系（特殊者指向一般执行者）。

3. 依赖（Dependency）关系

右图中，如果想“获得评分”，必须先“提交作业”，所以这是一个依赖的关系，用虚线长箭头，从向基用例指向被依赖用例，表示没有后者的话，前者无法执行。

4. 扩展（Extend）关系

右图中，在“获得评分”之后，还可以看看整体得分情况，以得到自己的排名，所以“查看成绩排名”是“获得评分”的一个扩展。

这种情况允许一个用例扩展另一个用例提供的功能，与泛化类似，但有更多限制：基本用例必须声明“扩展点”，扩展用例只能在扩展点上增加新行为。

在参与者之间，也可能存在泛化关系，比如“学生”可能会泛化为“本地学生”和“留学生”，“老师”可能会泛化为“本校老师”和“访问学者”。

## 6.7.3 用例说明

用例说明通常与用例图配合使用，以进一步描绘用例功能，见表 6.7.1。

表6.7.1 - 用例说明表

|项目|内容|
|--|--|
|用例编号|如：ASE-01|
|用例名称|即用例图中的描述，如“浏览作业”|
|参与者|在本例中为“学生”|
|优先级|高、中、低（三者选一）|
|用例说明|如：学生可以浏览老师布置的所有作业历史及最新作业。|
|前置条件|执行本用例前的系统状态，如：学生必须先输入学生ID和课程ID。|
|基本事件流|说明在正常情况下，最常用的流程。如：学生点击“浏览作业”按钮，系统根据课程ID查询作业历史，然后以列表形式在界面上显示。|
|异常事件流|说明在出现错误和其它异常时，和基本流程的不同之处。如：登录失败，课程已到达上限，该课程尚无作业，等等。|
|后置条件|数据库的变化、系统界面变化等，如：学生可以看到作业列表。|

