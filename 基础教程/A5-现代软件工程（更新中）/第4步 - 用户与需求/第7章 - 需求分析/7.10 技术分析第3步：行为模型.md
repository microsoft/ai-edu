
## 7.10 技术分析第三步：行为模型

这是需求分析的第三步，在这一步中，我们要建立“行为模型”。步骤如图7.10.1：


<img src="img/Slide41.SVG"/>

图 7.10.1 行为模型


这种模型可以用于表示：

- 系统动态和行为，或者是对象的状态和行为；
- 描述了在用户模型和结构模型中所描述的各种结构元素之间的交互和协作。

请注意：到了这里已经快接近设计范畴了，也就是说，我们已经快破开鸡蛋壳了，一旦破壳，就会进入设计的大门。所以到了这一步，是需求分析的最后一个环节了。说到底，需求分析和系统设计也不是完全隔离的，所以在这一步里有些交融也是合理的。

动态模型表示瞬时的、行为化的系统的“控制”性质，规定了对象模型中对象的合法变化序列。即对象的动态行为。
用状态图来描绘对象的状态、触发状态转换的事件、以及对象的行为（对事件的响应）。
每个类的动态行为用一张状态图来描绘，各个类的状态图通过共享事件合并起来，从而构成系统的动态模型



活动图和状态图的区别
活动图着重表现从一个活动到另一个活动的控制流，是内部处理驱动的流程
状态图着重描述从一个状态到另一个状态的流程，主要有外部事件的参与

活动图和流程图的区别
流程图着重描述处理过程，它的主要控制结构是顺序、分支和循环，各个处理之间有严格的顺序和时间关系
活动图描述的则是对象活动的顺序关系所遵循的规则，它着重表现的是系统的行为，而非系统的处理过程
活动图能够表示并发活动的情形，流程图不能


### 7.10.1 对象状态转换

#### 1. 需求分析阶段

State Machine，状态转换（迁移）图是描述对象的状态在响应外部的信号后进行转换的一种图形表示。

我们以作业对象为例，绘制出状态转换图，如图 7.10.2 左侧上方所示。我们可以看到四种图例：

1. 起始状态，实心圆形；
2. 终止状态，小实心圆形外套空心圆；
3. 状态，被观察到的对象行为模式，用圆角矩形表示；
4. 事件或行为，引起状态转换的外界事件，用有方向的连接线表示；
5. 菱形，判断条件。

在需求分析阶段，是对现实世界做状态转换分析。图 7.10.2 左侧下方是状态转换表。

1. “起始”状态：老师布置作业。比如，老师在课堂上布置作业：“同学们回去后把 CNN 的模型在 Cifar-10 数据集上再跑一遍，自己调参，看看准确率如何”；

2. 学生听到后，把内容记录在小本子上，状态为“已接收”；

3. 学生课下做试验，调整参数，把自己最满意的结果记录下来，成为作业上交，状态为“已提交”；

4. 老师接收到作业后进行批改评测，并把分数记录在案，状态为“已批改”；

5. 如果有不合格的作业，则打回给学生重新做，状态变回“已提交”；

6. 合格的作业最后会回到“终止”状态。

<img src="img/Slide42.SVG"/>

图 7.10.2 对象级别的状态转换


#### 2. 系统设计阶段

在需求分析阶段，很容易犯的错误是绘制图 7.10.2 右侧。与左侧比较，可以看到后者多出来几个状态：

- 未完成
- 已完成
- 批改中

这是为什么呢？

因为左侧是现实世界中的状态转换图，是一种（客观）需求分析的结果；而右侧是软件世界的状态转换图，是（主观）系统设计的结果。

我们用“未完成”状态为例说明：

- 在现实世界中，未完成的状态确实存在，但是它对环境来说毫无意义：老师最后只看你是不是及时完成了作业，而家长会一直督促你，直到你完成作业。所以，“未完成”状态在现实世界中，从老师的角度来看，是一个不可接受的状态；

- 在软件世界中，如果处于“未完成”状态，学生是可以临时保存作业，留着以后再完成的，所以“未完成”状态对于软件系统（环境）来说，是有意义的：可以保存入磁盘，并可以再次从磁盘加载到内存。

而“已完成”状态的意义是：到达这个状态后，软件系统才会允许提交作业进入下一个状态，相当于软件代替了老师和家长的监督作用：学生没有完成作业就必须完成后才能提交。

“批改中”的作用和“未完成”类似，也是可以保存入磁盘，以后再次加载的。

依赖于软件系统的支持，学生还可以决定：

- 是否在完成作业后，在回过头来修改；
- 是否在提交作业后，在老师还没有批改的前提下，收回作业，做进一步的修改。

也可以用表格来表示这种转换关系，但是不如状态转换图方便理解。


### 7.10.2 对象活动（Activity）

状态转换图的关注点在状态上，保证状态是完备正确的。而对于状态转换的触发条件——活动，由活动图来完成。活动图有两种：简单活动图，泳道活动图。

活动图是UML用于对系统的动态行为建模的另一种常用工具，它描述活动的顺序，展现从一个活动到另一个活动的控制流。活动图在本质上是一种流程图，活动图着重表现从一个活动到另一个活动的控制流。

#### 1. 简单活动图

图 7.10.3 左侧是简单活动图，它把不同的角色混在一起，以作业为线索，构成一个完整的流程。

1. 开始。
2. 老师在课堂布置作业。
3. 学生收到作业，记录在作业本上。
4. 学生回去做作业，完成后统一上交。
  
   该图省去了“上交作业”的步骤，因为它在需求中并不重要。但是，如果在系统设计时，“提交作业”就是一个很重要的计算机操作步骤。

5. 老师批改作业，如果合格则结束，如果不合格，发回给学生修改，直到合格为止。

<img src="img/Slide43.SVG"/>

图 7.10.3 对象活动图

#### 2. 泳道活动图

如果把不同的对象的活动放在不同的“泳道”中，共同完成一个完整的流程，则称为泳道活动图。如图 7.10.3 右侧所示。

该图中把老师和学生的活动（用例）分别画在两个泳道上：
- 老师布置作业后，可以进行课外辅导。因为课外辅导与学生做作业可以同时进行，所以这在简单的活动图中无法绘制出来。等到收到学生上交的作业后，再进行批改。
- 学生在收到作业后，可以选择参加课外辅导，也可以很有把握地自己直接完成作业。但是无论是否参加辅导，不合格的作业都需要重写。


### 7.10.3 对象交互


