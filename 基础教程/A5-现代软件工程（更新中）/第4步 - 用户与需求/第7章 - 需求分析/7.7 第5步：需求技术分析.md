## 7.7 第五步：需求技术分析

目前，软件需求的技术分析方法较多，如图 7.7.1 所示，有一些大同小异，而有的则基本思路相差很大，比如有自下而上的，也有自上而下的，这两者的思路正好相反。笔者提倡自上而下由全局出发全面规划分析，然后逐步设计实现。


<img src="img/Slide27.SVG"/>

图 7.7.1 需求技术分析的各种方法


在这一节中，我们泛泛地介绍各种需求技术分析方法，只要求大家知道有这些方法存在，不要求全部掌握，有兴趣的读者可以自己做深入研究。最后我们会详细介绍面向对象的分析方法，这是本书中要重点介绍的方法。

### 7.7.1 软件需求分析方法

从系统分析出发，可将需求分析方法大致分为功能分解方法、结构化分析方法、信息建模法和面向对象的分析方法。

#### 1. 功能分解方法

将新系统作为多功能模块的组合，各功能也可分解为若干子功能及接口，子功能再继续分解，便可得到系统的雏形，即公式 7.7.1 所示：

$$
功能分解 = 功能 + 子功能 + 功能接口 \tag{7.7.1}
$$

对于一个比较小的软件，或者是一个大系统中的局部功能，可以使用这种简便的方法。

#### 2. 结构化分析方法

结构化分析方法是由数据流图和数据词典构成并表示，所以此分析法又称为数据流法。其基本策略是跟踪数据流，即研究问题域中数据流动方式及在各个环节上所进行的处理，从而发现数据流和加工方法。结构化分析可定义为数据流、数据处理或加工、数据存储、端点、处理说明和数据字典。

$$
\begin{aligned}
数据流图 &= 数据流 + 数据处理 + 数据存储 + 端点 \\
数据说明 &= 端点说明 + 处理说明 + 数据字典 \\
结构化分析 &= 数据流图 + 数据说明
\end{aligned} \tag{7.7.2}
$$

结构化分析法和下面要说的面向对象分析法，并不是对立的，二者可以配合使用。因为在刚开始进行分析时，不可能马上就能发现真正的“对象”，而用数据流图可以重现真实需求，帮助分析人员逐步进入状态，这也是笔者多年的经验。

#### 3. 信息建模方法

信息建模可定义为实体或对象、属性、关系、父类型/子类型和关联对象。此方法的核心概念是实体和关系，最初由 P.P.S. Chen 在1976年提出，基本工具是 E-R 图。1981年 M.Flavin 改进后称之为信息建模法，后来又发展为语义数据建模法，并引入了面向对象的特定。其基本要素由实体、属性和联系构成。该方法的基本策略是从现实中找出实体，然后再用属性进行描述。

$$
\begin{aligned}
内部信息 &= 实体或对象 + 属性 \\
外部信息 &= 关系 + 父子类型 + 关联对象 \\
信息建模 &= 内部信息 + 外部信息
\end{aligned} \tag{7.7.3}
$$

#### 4. 面向对象的分析方法

  面向对象的分析方法的关键是识别问题域内的对象，分析它们之间的关系，并建立三类模型，即：

  - 对象模型
  - 动态模型
  - 功能模型

  面向对象主要考虑类或对象、结构与连接、继承和封装、消息通信，只表示面向对象的分析中几项最重要特征。类或对象是对问题域中事物的完整映射，包括事物的数据特征（即属性）和行为特征（即服务）。

$$
\begin{aligned}
实体 &= 对象或类 + 结构与连接 \\
特征 &= 继承 + 封装 + 消息通信 \\
 &= 数据特征 + 行为特征 \\
面向对象分析 &= 实体分析 + 特征分析
\end{aligned} \tag{7.7.4}
$$

由于面向对象分析方法的先进性和重要性，我们在下面着重介绍一下。

### 7.7.2 面向对象的分析方法

OOA（Objec-Oriented Analysis），面向对象的分析方法，目前已经衍生出许多方法，每种方法都有各自的进行产品或系统分析的过程，都有一组可描述过程演进的图形标识，以及能使得软件工程师可以理解一致的符号体系。


<img src="img/Slide28.SVG"/>

图 7.7.2 面向对象的分析方法


现在广泛使用的 OOA 方法有以下几种：

#### 1. Booch 方法

Booch 由Grady Booch 在 Rational Software 公司工作时提出。方法包含“微开发过程”和“宏开发过程”。微开发过程定义了一组任务，并在宏开发过程的每一步骤中反复使用它们，以螺旋上升的方式维持演进途径。Booch OOA 宏开发过程的任务包括四个步骤：

1. 标识类和对象。
2. 确定类和对象的含义。
3. 定义类与类、对象与对象间的关系。
4. 说明每个类的接口和实现。

#### 2. Rumbaugh-OMT 方法

该方法是 1991 年由 James Rumbaugh 等 5 人提出来的，其经典著作为"面向对象的建模与设计"。Rumbaugh 和他的同事提出的对象模型化技术（OMT）用于分析、系统设计和对象级设计 。分析活动建立三个模型：对象模型（描述对象、类、层次和关系），动态模型（描述对象和系统的行为），功能模型（类似于高层的 DFD，描述穿越系统的信息流）。

1. 建立对象模型

   面向对象分析首要的工作，是建立问题域的对象模型。这个模型描述了现实世界中的“类与对象”以及它们之间的关系，表示了目标系统的静态数据结构。静态数据结构对应用细节依赖较少，比较容易确定；当用户的需求变化时，静态数据结构相对来说比较稳定。因此，用面向对象方法开发绝大多数软件时，都首先建立对象模型，然后再建立另外两个子模型。

   对象模型通常有5个层次，基本的工作步骤是：确定对象和类（object and class），确定结构（structure），确定主题（subject），确定属性（attribute），确定方法（method）。

2. 建立动态模型

   包括四个步骤：编写典型交互行为的脚本；从脚本中提取出事件，确定触发每个事件的动作对象以及接受事件的目标对象；排列事件发生的次序，确定每个对象可能有的状态及状态间的转换关系，并用状态图描绘它们；最后，比较各个对象的状态图，检查它们之间的一致性，确保事件之间的匹配。

3. 建立功能模型

   功能模型表明了系统中数据之间的依赖关系，以及有关的数据处理功能，它由一组数据流图组成。其中的处理功能可以用 IPO（Input/Processing/Output，输入/处理/输出）图（或表）、伪码等多种方式进一步描述。通常在建立对象模型和动态模型之后再建立功能模型。

#### 3. Coad/Yourdon 方法

该方法是 1989 年 Coad 和 Yourdon 提出的面向对象开发方法。Coad 和 Yourdon 方法常常被认为是最容易学习的 OOA 方法。建模符号相当简单，而且开发分析模型直接明了。其 OOA 过程概述如下：

1. 标识类和对象，可以从应用领域开始，逐步确定形成整个应用的基础的类和对象。
2. 标识结构，典型的结构有两种，一般/特殊结构和整体/部分结构。
3. 标识属性，找出在目标系统中对象所需要的属性，而后将属性安排到适当的位置，找出实例连接。
4. 标识服务，对象收到消息后执行的操作称为对象提供的服务，它描述了系统需要执行的处理和功能。
5. 标识主题，对模型进行划分，给出模型的整体框架，划分出层次结构。

Coad/Yourdon方法中的 OOD 模型对应于面向对象设计的四个主要活动步骤，分别是：

1. 设计问题域子系统：主要是对OOA模型中的主题层进行细化，将系统划分为若干个问题域子系统，每个子系统包含一组相关的类和对象，负责一定的功能。
2. 设计人机界面：主要是对OOA模型中的服务层进行细化，设计用户与系统交互的界面，包括菜单、窗口、对话框、按钮等。
3. 设计任务管理：主要是对OOA模型中的结构层进行细化，设计系统的并发和同步机制，包括进程、线程、信号量、消息队列等。
4. 设计数据管理：主要是对OOA模型中的属性层进行细化，设计系统的数据存储和访问方式，包括文件、数据库、缓存等。

#### 4. Jacobson-OOSE 方法

也称为 OOSE（面向对象软件工程）。Jacobson 方法与其他方法的不同之处在于他特别强调使用实例（use case）描述用户与系统之间如何交互的场景。Jacobson 方法概述如下：

1. 建立需求模型，通过定义参与者及其职责、使用实例、对象和关系的初步视图。
2. 建立分析模型，通过标识界面对象、建立界面对象的结构视图、表示对象行为、分离出每个对象的子系统和模型。
3. 建立设计模型。
4. 建立实现模型。
5. 建立测试模型，包括不同程度的保证，这种保证从低层的单元测试延伸到高层的系统测试。

#### 5. Wirfs-Brock 方法

Rebecca Wirfs-Brock于1990年提出，它以“责任驱动设计”（Responsibility-Driven Design）的思想而著称，强调从类、责任和合作关系对应用进行建模。Wirfs-Brock 方法不明确区分分析和设计任务。从评估客户规格说明到设计完成，是一个连续的过程。与 Wirfs-Brock 分析有关的任务概述如下：

1. 评估客户规格说明，使用语法分析从规格说明中提取候选类。
2. 定义每一个类的职责，或将职责赋予每个类。
3. 标识类之间的关系，基于职责定义类之间的协作。
4. 建立类的层次表示，构造系统的协作图。
5. 把类聚合在一起形成子系统。

能看出它是一种自底向上的方法。

#### 6. 统一的OOA方法（UML）

统一的建模语言（UML）已经被广泛使用，它把 Booch、Rumbaugh和Jacobson 等各自独立的 OOA 和 OOD 方法中最优秀的特色组合成一个统一的方法。在 UML 中用 5 种不同的视图来表示一个系统，这些视图从不同的侧面描述系统。每一个视图由一组图形来定义。这些视图形成一个序列，如图 7.7.3 所示：


<img src="img/Slide29.SVG"/>

图 7.7.3 UML 中的模型视图



1. 用户模型视图
   
   也可以叫做功能模型。

   这个视图从用户（ 在UML中叫做参与者）角度来表示系统。它使用用例（use case）来建立模型，并用它来描述来自终端用户方面的可用的场景，在 7.7 节中讲述。
   
2. 结构模型视图
   
   也可以叫做对象模型。

   从系统内部来看数据和功能，即对静态结构（类、对象和关系）模型化，在 7.7 节中讲述。
   
3. 行为模型视图
   
   也可以叫做动态模型。

   这种视图表示了系统状态和行为，还描述了在用户模型视图和结构模型视图中所描述的各种结构元素之间的交互和协作，在 7.9 节中讲述。
   
4. 实现模型视图
   
   将系统的结构和行为表达成为易于转换为实现的方式，在本书的第 5 部分中讲述。
   
5. 环境模型视图
   
   表示系统实现环境的结构和行为，在本书的第 6 部分中讲述。

通常，UML 需求分析建模的注意力放在系统的用户模型和结构模型视图，而 UML 系统设计建模则定位在行为模型、实现模型和环境模型。但是正如 7.9 节中将要学习到的，行为模型有两种：一种是还原现实世界的行为，属于需求分析的范畴；另外一种是在计算机的数字世界中设计新的行为模型，后者是对前者的抽象和扩充。

### 7.7.3 小结

#### 1. 各种需求分析方法的比较

上面介绍了很多中需求分析方法，各有各的侧重点。笔者仔细分析了整个需求分析的脉络后发现，其实这些方法都是遵从表 7.7.1 中的基本步骤。

表 7.7.1 - 各种需求方法的比较

|步骤|功能分解法|结构化分析法|信息建模法|OMT 法|UML 法|
|--|--|--|--|--|--|
|1.描述原始需求|功能|系统关系图，顶层数据流图|原始信息|功能模型|用户模型|
|2.提取静态结构|子功能|数据存储，端点|对象和属性|对象模型|结构模型|
|3.捕捉动态行为|功能接口|数据处理，数据流|关系类型，关联对象|动态模型|行为模型|

表 7.7.1 的内容，需要对各种方法仔细研究后才能理解，最后的结论是，无论哪种方法，都可以异曲同工地达到需求分析的目的，所以在实践中可以选取一种方法为主导，混用一些其它的自己熟悉的分析方法。

#### 2. 需求分析与系统设计的分界线

在面向对象法中，要求建立对象模型、动态模型、功能模型。其实这个理论本身已经偏向系统分析/设计了，对很多需求分析的内容并不涵盖。在很多资料上并没有介绍具体如何做，导致很多人在实践中把分析和设计阶段的任务混为一谈。

为什么这种情况能一直持续下去呢，一个重要原因是在一般的软件公司里，总会有一位“领域专家”，往往是他/她既做需求分析，又做系统设计。在微软其实也是这样，没有各自独立的角色分别做需求分析和系统设计两件事，往往是一个从底层做起的程序员，逐渐成长为领域专家后，再去负责需求分析与系统设计的工作。

这样做的好处显而易见：合并需求分析和系统设计两个过程，能够敏捷开发，快速迭代，用 MVP（Minimum Viable Product，最小可行产品）理念实现软件产品，逐步完善。

但问题也是存在的：

1. 他/她在做需求分析（做什么）的时候，脑子里会不自觉地想到如何去实现（如何做），这样就混淆了“做什么”和“如何做”；
2. 写出来的文档没有边界；
3. 定义出来的类会让后续的开发人员感觉到限制；
4. 隐藏了一些真实的用户需求，而用自己的理解直接代替。

这会带来什么问题呢？该员工一旦离职，这个项目就垮掉了，因为所有的东西都在他脑子里。

用一个简单的比喻帮助大家理理解它们的分界线：我们在做需求分析的时候，可以把每个角色、实体、模块等等都看作一个鸡蛋，它们在需求分析阶段都是不透明的，我们也不需要在需求分析阶段去窥探鸡蛋内部的构造，否则的话，我们会得到一堆破鸡蛋——所有的蛋液流出来并混在一起，造成无法进行下一步的分析。

这个鸡蛋壳，就处于上述的“统一的 OOA 方法”的5个视图中的第3个上，如图 7.7.3 中的分界线所示。

笔者在多年的软件工程实践中也总结出了一套方法，经过与各种模型、理论的对比，发现竟然与“统一的 OOA 方法”完全一致！所以，我们会在后续的章节中通过真实的案例继续介绍这种方法。

