
## 12.4 树形系统架构模式

### 12.4.1 代理模式 (Broker pattern)
#### 架构说明

代理模式用于在结构化系统中对组件解耦。系统内各组件间采用远过程调用（remote service invocations）的方式交互。代理（Broker）组件充当组件间通讯的协调角色。

提供服务的组件将其能力（服务以及特性）发布给代理，客户端均向代理请求服务，由代理将请求重定向到先前已发布过对应服务的组件进行处理。

使用场景
消息中间件软件：Apache ActiveMQ，Apache Kafka，RabbitMQ 与 JBoss 等等

#### 优缺点

优点：
- 通过一个代理对象完成一系列的处理，在将来的程序改动中，就会允许动态更改、添加、删除和重新定位对象，这使开发人员的发布变得透明，符合开闭原则。
- 代理模式能够协调调用者和被调用者，在一定程度上降低了系统的耦合度。
- 远程代理使得客户端可以访问在远程机器上的对象，远程机器可能具有更好的计算机性能与处理速度，可以快速响应并处理客户端请求。
- 代理模式在架构中还可以让虚拟代理通过使用一个小对象来代表一个大对象，可以减少系统资源的消耗，对系统进行优化并提高运行速度

缺点：

- 要求对服务描述进行标准化，我们要使用代理模式时则需要考虑异步处理机制、协议创建流程和错误环境控制，比较的繁琐。
- 由于在客户端和真实主题之间增加了代理对象，因此有些类型的代理模式可能会造成请求的处理速度变慢。
- 实现代理模式需要额外的工作，有些代理模式的实现非常复杂。这些问题就造成了不易开发的弱点。


#### 应用场景

- 当客户端对象需要访问远程主机中的对象时可以使用远程代理。
- 当需要用一个消耗资源较少的对象来代表一个消耗资源较多的对象，从而降低系统开销、缩短运行时间时可以使用虚拟代理，例如一个对象需要很长时间才能完成加载时。
- 当需要为某一个被频繁访问的操作结果提供一个临时存储空间，以供多个客户端共享访问这些结果时可以使用缓冲代理。通过使用缓冲代理，系统无须在客户端每一次访问时都重新执行操作，只需直接从临时缓冲区获取操作结果即可。
- 当需要控制对一个对象的访问，为不同用户提供不同级别的访问权限时可以使用保护代理。
- 当需要为一个对象的访问（引用）提供一些额外的操作时可以使用智能引用代理。


#### 几种“代理”的区别

|英文|中文|解释|比喻|
|-|-|-|-|
|Agent|自主性代理|智能性较高，接收到 A 的请求，自主决定访问 B 还是访问 C，然后把 B 或 C 的返回结果告诉 A，但 A 并不知道 B 或 C 的存在||
|Broker|中介性代理|A 通过本代理得知 B 的存在，但是不知道如何访问 B，发送请求给代理，代理把该请求变成 B 可以听懂的语言发送给 B 并获得结果返回给 A|股票经纪人代买卖股票|
|Delegate|委托性代理|A 不知道怎么才能从 B 那里得到服务，甚至不知道 B 的存在，就把请求告诉代理，代理完成其它的任务|律师代理诉讼|
|Proxy|透传性代理|无智能，在 A 不能合法/有效地访问B时，把 A 的请求拿过来原封不动地传给 B，再把 B 的响应原封不动地回传给 A|传声筒|

### 12.4.2 事件总线模式 (Event-bus pattern)

#### 架构说明

事件总线模式应用于事件处理，主要由四个组件构成：事件源（event source），事件侦听者（event listener），通道（Channel）以及总线（event bus）。 事件源将消息发布到总线的特定通道，侦听者订阅相应的通道，事件源所发布的消息经通道通告给订阅通道的侦听者。

使用场景
Android 开发
通告（Notification）服务

#### 优缺点

#### 应用场景
