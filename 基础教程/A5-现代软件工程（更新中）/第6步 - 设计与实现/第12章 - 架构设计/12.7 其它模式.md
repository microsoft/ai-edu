

### 12.2.3 技术架构模式

**架构模式**是在给定上下文中对软件构建中常见问题的通用、可重用解决方案。架构模式类似于软件设计模式，但层次更高、范围更广。架构对应着架构模式；框架本身就是个模式，只不过包含基础功能代码；而设计对应着设计模式。

所谓技术架构模式，就是面向实现的架构设计，用于指导后面的概要设计。在本章中主要讨论这种架构模式，其它的如逻辑、过程、数据等等的架构，在后面的章节讨论。

一些基本的技术架构模式如下：

#### 串行模式

- 分层模式（Layered pattern）
- 管道-过滤器模式（Pipe-filter pattern）

#### 星形模式

- 客户端-服务器模式（Client-server pattern）
- 对等模式（Peer-to-peer pattern）
- 主-从模式（Master-slave pattern）

#### 树形模式

- 代理模式（Broker pattern）
- 事件总线模式（Event-bus pattern）

#### 环形模式

- 模型-视图-控制器模式（Model-view-controller pattern）
- 黑板模式（Blackboard pattern）
- 解析器模式（Interpreter pattern）

一个复杂系统的架构是由以上这些架构模式有机组合而成。


优缺点表格





### 微服务

### 微架构
还有一种编程模式，常用于 Unix/Linux 的命令行模式中，如下伪代码片段：

```python
while(True):
   sleep(10)  # 休眠 10 毫秒
   event = check_event(device1)  # 检测事件
   if event is not None:
      process(event)  # 处理事件
   
   event = check_event(device2)  # 检测事件
   if event is not None:
      process(event)  # 处理事件
```

这是用一个 while(True) 写的“死循环”，它不断地检测每个设备上有没有新的事件到来，如果有，就进行相应的处理。为了不让 CPU 持续运转，在每次循环开始都要休眠 10 毫秒，否则 CPU 会被 100% 占用。

这种模式常用于通信场景中，因为通信板卡都是以事件的形式把各种通信事件发送给应用程序，比如响铃、摘机、按键、挂机等。而应用程序处理这些事件也是非常地迅速，向设备发送一个命令后，就可以异步地立刻返回而无需等待，基本可以在毫秒级返回。

对于不同的设备，采用轮询方式依次进行检测，通常这些设备之间是独立的，没有任何关系。

其实在 Windows 操作系统上的编程模式也是一个消息循环，这在 Win32 API 中非常典型，但是在后续的升级 API 中使用了事件、委托等方式，避免让程序员直接看到消息循环，提高了系统的安全性。

### 12.6.3 黑板模式（Black Board）

#### 架构说明

#### 优缺点

#### 应用场景

一、定义

黑板模式是一种常用的架构模式，应用中的多种不同数据处理逻辑相互影响和协同来完成数据分析处理。黑板模式允许多个消息读写者同时存在，消息的生产者和消费者完全分开。这就像一个黑板，任何一个教授（消息的生产者）都可以在其上书写消息，任何一个学生（消息的消费者）都可以从黑板上读取消息，两者在空间和时间上可以解耦，并且互不干扰。这种模式对于没有确定解决方案策略的问题是有用的。

二、模式组成

黑板模式由3个主要组成部分组成。

(1)知识源：包含独立的、与应用程序相关的知识，知识源之间不直接进行通讯，它们之间的交互只通过黑板来完成。

(2)黑板数据结构：按照与应用程序相关的层次来组织并解决问题的数据，知识源通过不断地改变黑板数据来解决问题。

(3)控制组件；完全由黑板的状态驱动，黑板状态的改变决定了需要使用的特定知识。

黑板模式一般不会对架构产生什么影响，但它通常会要求有一个清晰的消息结构。黑板模式一般都会提供一系列的过滤器，以便消息的消费者不再接触到与自己无关的消息。在实际开发中，黑板模式常见的有两种实现方式：

（一）数据库作为黑板

利用数据库充当黑板，生产者更新数据信息，不同的消费者共享数据库中信息，这是最常见的实现方式。该方式在技术上容易实现，开发量较少，熟悉度较高。缺点是在大量消息和高频率访问的情况下，性能会受到一定影响。在该模式下，消息的读取是通过消费者主动“拉取”，因此该模式也叫做“拉模式”。

（二）以语音识别为例：

语音识别黑板里边就是语言包 ；语言包就是知识源，控制机构就是管理语言包的，当你说一句话，不知道是什么语言，所以时非确定性的问题，控制机构把你说的话对应的语言包给你看，这就是黑板模式的流程

所有的组件都可以访问黑板。组件可以生成添加到黑板上的新数据对象。组件在黑板上查找特定类型的数据，并通过与现有知识源的模式匹配来查找这些数据。

三、模式实现

（一）利用数据库

利用数据库充当黑板，不同的应用共享数据库中信息，并且可以更新数据信息。这也是最常见的实现方式。

（二）利用发布—订阅模式

这种实现方式通常采用消息队列作为黑板，队列工作在主题模式（Topic），专家作为队列的订阅者，同时可以向队列发送消息，消息会被发送至所有订阅者。以上过程实现了专家间的信息交流。

四、影响黑板系统的因素

影响黑板系统设计的最大因素是引用问题本身的特性，但是支撑应用程序的黑板体系结构有许多相似的特征和构件。对于特定应用问题，黑板系统可通过选取各种黑板、知识源和控制模块的构件来设计；也可以利用预先制定的黑板体系结构的编程环境。

五、应用实例

黑板系统的典型应用是信号处理领域，如网络信息检索、电子商务、自动控制、商业管理智能决策、语音和模式识别、智能控制领域等

实际应用

在实际应用中常见的实现模式有：

A 利用数据库

利用数据库充当黑板，不同的应用共享数据库中信息，并且可以更新数据信息。这也是最常见的实现方式。

特点：

1 便于实现信息的查询，筛选和统计，这方面关系数据库提供了SQL 92的强大支持。

2 不能用于较高实时性要求的环境，这种实现是工作在“拉模式”下的，并且高频率的访问数据库会导致严重的系统性能问题。

B 利用发布—订阅模式

这种实现方式通常采用消息队列作为黑板，队列工作在主题模式（Topic），专家作为队列的订阅者，同时可以向队列发送消息，消息会被发送至所有订阅者。以上过程实现了专家间的信息交流。

特点：

1、可以有效应用于实时性要求较高的系统，这种实现工作在“推模式”下。

2、难于实现信息的统计分析，不像实现方式一那样可以通过SQL支持，这些工作必须开发者自己完成。

六、优缺点分析

优点：可用于非确定性问题求解，启发式解决过程，可维护性，可重用

缺点：不能确保期望结果，效率低下，回退，不支持并行，共享空间的访问需要同步

