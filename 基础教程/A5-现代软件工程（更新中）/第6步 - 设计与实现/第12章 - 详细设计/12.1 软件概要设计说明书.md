
# 软件概要设计说明书

在微软，通常把概要设计说明书称作 Dev Spec 或 Design Spec，因为这是 Developer 要完成的任务。如果软件规模大的话，通常由 Dev Manager 或 Dev Lead 来撰写，如果是一个局部功能，就由 IC（Individual Contributor，即开发人员）来撰写。

概要设计说明书是概要设计阶段完成后的输出。

## Overview/Terminology 概述/概念

### 任务概述

可以摘抄需求规格说明书（PM Spec）的主要内容。

### 术语解释

对一些设计领域或者程序内部模块、子系统命名的术语加以说明。

## Environment/Architecture 运行环境/总体设计

### 运行环境

描述软件分发/上线后的运行环境：

- 软件运行环境
  
  如 iOS 或 Android 手机系统、Windows 系统（台式机、HoloLens、Xbox、Surface Hub）、Linux 系统等。

- 硬件运行环境
  
  比如：智能手机、独立计算机、服务器、虚拟机、云端服务等，应包含对内存、硬盘、网络的要求。

### Architectural Design 架构设计

一些教材会把 Architectural Design 解释成结构设计，然后一下子就进入到模块操作问题上去了，这实际上是不正确的，在这一步，我们还没有涉及到那么细节的问题。

架构设计是一个很虚的概念，可以表现出来的形式有很多。笔者推荐下面的定义：

- 分层设计
  
  分层，首先需要功能分类，相同类别的功能可以构成大模块或者子系统。最流行的三层结构，即表示层、业务逻辑层、数据访问层，可以普遍适用到所有软件架构中。因为在三层结构的框架上，最上层总是用户接口，最下层总是数据存储，当然如果你的软件是一个局部模块开发，就不需要三层结构，而是要简单的多，那么基本上也不用分层设计了。
  
<image src="Images/Slide10.JPG">

- 模块/子系统设计

  各个软件系统不同的地方在于中间的业务逻辑层，可以有很多变化，比如：

  - 可以再细分成多层
  - 可以在同一层分割成很多模块
  - 可以是外部系统

  这里并不涉及模块内部的细节（属于详细设计范畴），只考虑外部轮廓。

<image src="Images/Slide4.JPG">

- 网络系统设计

  如果是分布式的系统，或者是涉及到多方通信的系统，包括对外部系统的依赖，都需要加入网络系统设计。包含：
  - 选择操作系统
  - 确定网络系统配置
  - 制定网络拓扑结构



【slide】

## Interface/Interaction 交互/接口设计

传统教材会在这部分定义“内部接口”和“外部接口”，笔者认为是不准确的。

内部接口全都是程序接口，而外部接口应该包括：

- 用户接口（当外部使用者是人类时，提供对人类友好的界面）
- 程序接口（当外部使用者是计算机时，提供对计算机友好的编程接口）

由于“用户接口”已经有单独定义了，所以“外部接口”只包含“程序接口”，不如直接把“内部接口”和“外部接口”合并在一起称为“程序接口”。

从另一方面推敲，外部接口是给外部用户（或系外部统）使用的，一旦有使用行为发送，则该用户（或系统）就是该系统的扩展，那也就没有什么内外的差别了。

### 用户接口

这是一个独立的文档，一般包含：

- 用户界面设计图
  
  业内成为 Redlines（红线图），因为红色很少用于界面元素中，所以用红线来做标记。

- 用户交互流程图
  
  用户在界面A上点击不同的按钮后，会跳到不同的新页面，从界面A的各个按钮上会引出一条条红线到其它界面。

由 Designer 完成，交给开发人员实现。

<image src="Images/redline.jpg">


### 程序接口

内部接口，一般包含以下几种形式：

- 函数调用
- 进程间通信（管道或者套接字）
- RESTful API

程序接口可以用两种图来表示：

<image src="Images/Slide7.JPG">

分层关系接口图

<image src="Images/Slide12.JPG">

组件交互时序图


## Static/Dynamic Data Design 数据设计

数据设计，一般是指对永久存储的数据的设计，包含数据库和数据文件两类。

### 数据库设计

一般是指关系式数据库。主要涉及的内容包括：

- 表
- 主键、外键、索引
- 存储过程

（Open question: 非关系式数据库是否包含在此？）

### 数据文件设计

一般是从类的属性做序列化得到数据文件，可能包括的数据文件类型有：

- 二进制
- 纯文本
- XML 扩展标记语言
- JSON 对象标记语言

如果是后两者，则格式中自带信息描述，就不用写设计文档了。如果是二进制文件，必须按字节描述文件格式。如果是纯文本格式，一般是按行分开记录，即 \r\n，使用 \tab 或逗号分割字段。

### 数据结构/接口设计

传统教材并不包含此类别的数据设计要求。

由于计算机软硬件技术的发展，有很多类型的数据是内存或网络中的临时运行用数据，比如：

- 栈
- 堆
- 数据包
- 消息队列

消息队列组件，队列中的数据平时是在内存中的，为了怕丢失任务，所以组件把内存中的数据也存储在了磁盘上。

这类数据如果是绑定在数据发送或接收方的对象上（作为属性），则可以在类设计（属于详细设计范畴）里包含。如果是比较独立的，既不从属于数据发送方，也不从属于数据接收方，则需要单独在这里设计。

<image src="Images/datadesign.jpg">

## Process/Threading 进程/线程运行设计

进程、线程的实现存在于代码中，但是如果不运行起来，非常难以识别。即使运行起来，人们也是无法“看到”其运行过程。

进程、线程设计包括：

- 名称
- 作用
- 生命周期（启动、停止条件）
- 实现机制（进程、线程、服务，或者是 Azure 上提供的一些其它计算服务）
- 运行物理环境（架构设计中的哪个服务器或者子系统）

<image src="Images/Slide11.JPG">

## Telemetry/Flighting 日志/试验

### Telemetry 日志

这个工作其实应该是 PM 的工作，定义哪一个用户行为需要记录日志，比如：

- 打开应用
- 点击按钮
- 打开某个网页
- 收藏了某个网页
- 关闭应用

这些日志会最终发送到服务器上，作为用户行为分析的数据源。

### Flighting 试验

1. 事先在系统中实现一个功能 A；
2. 如果你的系统是一个基于浏览器的服务，那么在服务器上可以随机地让某些用户看到功能 A 并使用，另外一些用户看不到；
3. 如果是基于手机的 App 应用，应用商店会有这种“只给10%的用户提供试验性功能下载”的功能，其它用户收不到新 App 下载通知。

## Exit Criteria/Open Issues 退出机制/已知问题

### Exit Criteria 中止/推出机制

遇到何种情况时，即停止开发工作、放弃项目。

如：

- 甲方公司使用的网络环境发生变化，导致前期的开发工作浪费。
- Windows 10 下一个发布计划中不再支持对浏览器的内置支持，所以依赖其开发的浏览器项目应该停止。

### Open Issues 已知问题

列出已知（尚未解决）的技术或其它方面的问题，这些问题有可能造成开发不能进行下去。

如：

- PDF 阅读与标记控件，在 Windows Form 或 XAML 应用程序中不能工作。
- 桥牌模型很有可能在3个月内无法训练出来，或者达不到预期要求的质量。

## Timeline/Work Item 工作计划

根据项目大小，有可能是多人合作完成，或者是单人独立完成：

- 多人合作
  
  列出分工及计划，如：

  |人员|工作|初步计划|
  |--|--|--|
  |木头|管理子系统|3周|
  |石头|推理子系统|4周|
  |肖哥|训练子系统|5周|
  |毛毛|存储接口模块|2周|

- 单人完成

  列出模块划分、完成时间。

  |模块名称|初步计划|
  |--|--|
  |Azure Blob 数据读写模块|2天|
  |Flask Restful 服务|10天|
  |发送邮件模块|3天|
  |开关 Azure 虚拟机模块|5天|
  