
## 14.1 详细设计说明书

可以找到的书籍或电子文档中，有很多版本的《详细设计说明书》，其实拿来任何一个都可以使用，但是看具体细节的话，有些是不合理的，如：

- 混淆概要设计和详细设计的范畴，详细设计里面讲了一大堆系统结构。应该把二者分开。
- 详细设计写了一些伪代码（Pseudocode）。
  以前有一种软件外包服务，起源于日本，由日本人写好伪代码，然后让中国的离岸外包程序员（在大连）参照伪代码写真实的代码。形式繁琐，设计人员不参与开发，或者反过来说是开发人员不参与设计，都效率低下。
- 罗列一堆没用的东西，比如什么概述、背景等等。由于这是详细设计文档，所以力求简洁，关注点放在技术细节上，减少开发人员的文档负担。
- 有的模板还让写“性能说明”，是性能要求还是实现性能呢？性能这种东西不经过测试是出不来结果的，而且不是设计的一部分，而是质量需求的一部分。

在这里笔者就不对已有版本的详细设计说明书进行仔细的分析了，而是直接给出建议的模板，其思路还是按照 13.5 中的表 13.5.2 所描述的各个阶段的设计任务来制定的。

### 14.1.1 建议的《详细设计说明书》模板

#### 1. 用例分析与数据流图

**1.1 用例分析**

使用“用例图”做用例分析。UML 用例图主要用来描述角色（可以理解为用户或使用者）以及角色与用例之间的连接关系。

**1.2 数据流图**

使用“数据流图”描述数据再系统中如何被传送或处理，以及描述数据处理功能模块。

有的读者可能有疑问：数据流图不是属于结构化设计中的概念吗？既然前面用了用例图，说明我们要用 OOD（面向对象设计），为什么还要画数据流图呢？因为在能够提取出对象之前，先把业务流程的来龙去脉搞清楚，就要靠数据流图，没有基础的东西，怎么可能抽象出东西来？

#### 2. 逻辑功能与接口设计

**2.1 逻辑功能**

本部分是重点，如果有多个模块，可以根据模块类别把关系紧密的模块写在一个详细设计文档中。

针对每个模块，需要有如下描述：模块名称、模块功能、输入项目、输出项目、关键流程、算法说明。对于没有的对应项目可以不写，比如算法说明不是所有模块都有。

有些模板中要求写“对象关系与类设计”，笔者认为不是必须的。一个模块中可能有很多类，尤其是在 23 种设计模式的要求下会多出很多东西，都写下来是个负担，也没人看。

**2.2 接口**

描述与本相关的模块之间的接口细节，主要描述本模块可以提供的调用接口。调用其它的模块的接口只需要给个名字即可，细节在被调用的模块中说明。

#### 3. 状态转换与交互设计

这一部分实际上是运行过程设计，只不过在详细设计阶段有它不同的侧重点。

**3.1 状态转换**

当一个对象中的状态很多时，需要有这一部分内容，用状态机（State Machine）的方式来描述对象内部的各种状态之间的转换条件和过程。用状态图绘制。

**3.2 交互过程**

交互过程描述了本模块与相关模块之间的调用关系。这种关系不是一般的一应一答的形式，而是作为核心调度模块时，对各种外部模块之间的协调。可以用交互图或者顺序图来绘制。

#### 4. 数据存储设计

数据表、库设计。

#### 5. 软件开发设计

模块内部使用的共用函数/包的说明
功能需求与程序关系

#### 6. 单元测试


3.9限制条件

3.10测试要点




### 14.1.2 机器学习模型类的详细设计说明书模板

# 模型概要设计说明书

训练一个机器学习的模型，通常也是软件工程的一部分。关于 AI 相关的软件工程，目前还鲜有资料提及。

以下是针对此类软件系统的概要设计说明书模板。

## Overview/Terminology 概述/概念

### 任务概述

可以摘抄需求规格说明书（PM Spec）的主要内容。

### 术语解释

对一些设计领域或者程序内部模块、子系统命名的术语加以说明。

## Environment/Architecture 运行环境/总体设计

### 运行环境

描述模型分发/上线后的运行环境：

- 软件运行环境
  
  如 iOS 或 Android 手机系统、Windows 系统（台式机、HoloLens、Xbox、Surface Hub）、Linux 系统等。

- 硬件运行环境
  
  比如：智能手机、独立计算机、服务器、虚拟机、云端服务等，应包含对内存、硬盘、网络的要求。

### Architectural Design 架构设计

模型所属系统的架构。

## Data Design 数据设计

- 数据标注手段
- 数据清理方法
- 数据分析，如相关性、正反指标、样本分布等
- 数据增强，是否需要数据增强手段
- 数据集分割，如何划分训练集、验证集、测试集

## Training/Inference 训练/推理子系统设计

### 训练模块

- 硬件
  - CPU/GPU
  - 单机/分布式
- 软件/框架
  - TensorFlow，PyTorch，第三方机器学习库，等等
- 算法/基础模型
  - 如SVM，KNN，GBT，等等
  - 或者CNN，RNN，LSTM，GNN，VGG16，等等
- 指标要求
  - 训练模型所需要的时间，以小时或天计算
  - 模型的参数尺寸
- 初始化
- 模型管理

### 推理模块

- 硬件
  - CPU/GPU
  - 单机/分布式
- 软件/框架
  - TensorFlow，PyTorch，第三方机器学习库，等等
- 指标要求
  - 主要是指单次推理所需要的时间，以毫秒计算
  - 或者是批量推理所需要的时间，以秒计算

## Telemetry/Flighting 日志/试验

### Telemetry 日志

从属于系统的日志行为，比如要记录用户触发的推理请求。

### Flighting 试验

从属于系统的试验方法。

## Exit Criteria/Open Issues 退出机制/已知问题

### Exit Criteria 中止/推出机制

遇到何种情况时，即停止开发工作、放弃项目。

如：

- 甲方公司使用的网络环境发生变化，导致前期的开发工作浪费。
- Windows 10 下一个发布计划中不再支持对浏览器的内置支持，所以依赖其开发的浏览器项目应该停止。

### Open Issues 已知问题

列出已知（尚未解决）的技术或其它方面的问题，这些问题有可能造成开发不能进行下去。

如：

- PDF 阅读与标记控件，在 Windows Form 或 XAML 应用程序中不能工作。
- 桥牌模型很有可能在3个月内无法训练出来，或者达不到预期要求的质量。

## Timeline/Work Item 工作计划

根据项目大小，有可能是多人合作完成，或者是单人独立完成：

- 多人合作
  
  列出分工及计划，如：

  |人员|工作|初步计划|
  |--|--|--|
  |木头|管理子系统|3周|
  |石头|推理子系统|4周|
  |肖哥|训练子系统|5周|
  |毛毛|存储接口模块|2周|

- 单人完成

  列出模块划分、完成时间。

  |模块名称|初步计划|
  |--|--|
  |Azure Blob 数据读写模块|2天|
  |Flask Restful 服务|10天|
  |发送邮件模块|3天|
  |开关 Azure 虚拟机模块|5天|
  