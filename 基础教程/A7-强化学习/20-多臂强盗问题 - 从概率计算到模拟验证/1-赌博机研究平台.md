## 2.1 赌博机研究平台

### 2.1.1 原始的赌博机

注意，赌博在中国是违法行为！在本章中的“赌博机”并非真正地研究赌博问题，而是把它抽象成为数学问题和强化学习问题，得到结论后用来解决类似的问题。把数学变成赌博工具是人类的发明，正如同科学可以救人也可以杀人一样。

赌博机，即“老虎机”，英语为 Slot Machine，或者 one-arm bandit（单臂强盗）。

- 为什么叫老虎机？

    - 因为最初的设计中，内部有三个大卷轴，印有很多图案；
    - 赌徒投入一个投硬币，搬动摇杆，卷轴开始各自转动；
    - 最终停止转动时，如果三个卷轴上面显示的都是老虎图案，赌徒会获取丰厚的奖励。
    
- 为什么叫单臂/多臂强盗？ 

    - 因为这机器回报率低，但是容易上瘾，让玩家输个精光，所以叫一条胳膊的强盗。很多现代的老虎机仍然保持一个传统的操作摇臂，可与按钮并行使用。

    - 有的赌徒有策略的操作多台老虎机，以实现最高的可能获利，这样的赌徒就称作“多臂强盗”（K-Armed Bandits）。

    - 某些翻译软件把 K-Armed Bandits 翻译成“武装匪徒”，因为 Armed 有“武装”的意思，读者自行理解吧。

### 2.1.2 如何在老虎机上赢钱

这是一个国外友人总结的如何在赌场中的老虎机上赢钱的几条经验。请读者一起阅读一下，以便对我们后续的算法研究提供思路。

1. Choose Slot Machines with High Price per Spin

    选择每次摇臂操作赌注高的老虎机。

    虽然这一提示似乎违反直觉，但下注的赌注越高的老虎机回报的频率越高，金额越大。这就是老虎机的设计方式，吐币的百分比与赌注大小成正比。此外，最大赌注可以帮助您解锁特殊功能，如免费旋转或头奖。

2. Choose the Least Complicated Slot Machines

    选择最简单的老虎机。

    在赌场使用这条普遍的经验法则：如果游戏复杂，它的回报就会少。在复杂的老虎机游戏中，赌场试图通过特殊的乘数、奖金或额外的生命来吸引你的注意力。虽然您可能喜欢这些特殊功能，但它们只会使游戏复杂化，并降低您获胜的几率。

3. Test the Machines Before you Play

    在玩之前测试机器。

    大多数赌场在其许多老虎机上提供免费试用，这意味着你可以先做测试五到十圈，让你更容易制定出一个行动计划，以便在使用真金白银的时候采取行动。

4. Use Cash Instead of Card

    以现金代替信用卡。

    赌场可以欺骗客户的一个窍门是，他们可以兑换零钱，这就是为什么赌场使用筹码而不是现金，玩家的借记卡/信用卡就像筹码一样。如果使用卡，玩家可能会忘记自己花了多少钱。只带一定数量的现金到赌场，购买一定数量的筹码，一旦损失殆尽后就离开。

5. Know When to Leave the Casino

    知道什么时候离开赌场。

    赌场里的老虎机注定会让人上瘾。赢钱时，你可能会想赢更多的钱；输钱时，你可能会想着把输的钱都赚回来。就和股票一样，如果没有止盈和止损目标，最后的结果差不多都是输光。

我们可以从中得到的指导思想是：

1. 先探索（exploration），看看哪个摇臂带来的回报最高。
2. 后利用（exploitation），确定好第一条后，就可以“贪婪地”获得回报。
3. 设置一个限制值来比较各自算法的优略，比如，比较 100 轮内哪个算法表现最好；扩大到 200 轮内又会有何变化？
4. 不同的应用场景使用不同的算法。
5. 设置合理的奖励值，便于比较算法性能。


### 2.1.3 多种赌博机研究平台

因为单臂的赌博机应用场景比较简单，所以在算法研究领域都是多臂赌博机平台，有以下几类：

#### 固定收益的多臂赌博机

如图 2.1.1 所示，假设是一个三臂赌博机，玩家投一次币（假设是一元钱），选择一个序号，拉动一次拉杆臂（或者按一次按钮）。

<center>

<img src='./img/mab-1.png'/>

图 2.1.1 固定收益的多臂赌博机
</center>

假设玩家选择 1 号，则该臂机会以 $p_1=0.3$ 的概率回吐一元钱做为奖励，即 10 次中可能有 3 次回吐一元钱，其它 7 次没有奖励。

另外两臂的回吐概率是 $p_2=0.5,p_3=0.8$，但是玩家在开始时并不知道这个信息，需要摸索。

这个应用场景相对简单，可以总结为：

- 收益固定为离散值 0/1，即伯努利分布。
- 收益概率可以灵活设置。
- 算法简单，运行速度快，见效快。
- 初选者容易理解。
- 有预设的上限可以参考：比如以图 2.1.1 的设置为例，玩 1000 次的最大收益应该是 800 元。
- 衡量指标有限，不能体现复杂算法的优势。
- 能体现客观世界（赌场）的真实情况，但是对算法研究没有帮助，所以不能应用于其它场景。

这种场景下，先玩 10 次，基本上就能知道 3 号臂是收益最高的，以后总拉动 3 号臂即可。

#### 收益按概率分布的多臂赌博机

第二类研究平台如图 2.1.2 所示，每个臂的回报有正有负，而且不固定，也不是整数。

<center>

<img src='./img/mab-2.png'/>

图 2.1.2 收益按概率分布的多臂赌博机
</center>

依然假设只有三臂，每个拉杆臂的收益都是一个正态分布，方差为 1，但是均值有可能是 0,-1,+1。

举例来说，假设用户选择 1 号臂，进行 200 轮游戏的话，会看到如图 2.1.2 的奖励分布。

<center>

<img src='./img/mab-2-sample.png'/>

图 2.1.2 收益按概率分布的多臂赌博机的 1 号臂
</center>

1 号臂的情况是：

- 奖励（即收益）是小数；
- 奖励在 0 附近的次数最多，占据了 70% 左右；
- 最大值有机会得到 +2 的奖励或更大，次数极少；
- 最小值有机会得到 -2 的奖励或更小，次数极少。

2 号和 3 号臂就是 1 号臂的分布情况分别向左或右移动一个单位。

现在我们假设玩家第一次玩就得到了 1 的奖励，那么猜猜看他选择的是哪个臂呢？

<center>

<img src='./img/mab-2-sample2.png'/>

图 2.1.4 收益按概率分布的多臂赌博机的 1 号臂
</center>

从图 2.1.3 看，三个臂都有可能得到 1 的奖励，3 号臂（绿色虚线）的概率最大，2 号臂（蓝色虚线）的概率最小，但是不能确定就是 3 号臂，而且玩家也没有事先知道图 2.1.4 所示的概率分布，这就给玩家的后续选择带来了不确定性。如何尽快地确定哪个臂最好，就是这一类多臂赌博机要解决的问题。


#### 上下文赌博机（Contextual Bandit）



#### 完全的
