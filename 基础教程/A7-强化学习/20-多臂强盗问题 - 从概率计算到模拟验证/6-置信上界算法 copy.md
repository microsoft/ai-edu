## 2.6 置信上界法（UCB）

UCB - Upper Confidence Bound，置信上界。

### 2.6.1 置信度和置信区间

#### 点估计

一个中学有 2000 名学生，体育老师想知道男生女生的平均身高。如果都测量一遍，工作量太大，所以体育老师就只在每个年级中抽测一个班的学生的身高，用于估计全校学生的平均身高。

#### 区间估计

在抽测之前，几个体育老师先给出了自己的“盲猜”。老师甲说：我估计男生的平均身高是 1.75 米，女生是 1.65 米。老师乙说：我估计男生的平均身高在 1.73 米到 1.77 米，女生是 1.62 米到 1.66 米之间。老师丙说：我估计男生在 1 米到 2 米之间，女生也一样......其它老师一阵哄笑......

#### 置信度（置信水平）与置信区间

置信度（confidence coefficient）

- 老师甲的估计数据过于精确，但是不容易正确。
- 老师丙说的虽然是个笑话，但是它的准确程度基本上可以达到 100%。
- 老师乙估计得更“靠谱”一些，也就是说有 95% 的把握是正确的，这个 95% 就是置信度，[1.73,1.77] 以及 [1.62,1.66] 就是置信区间。

#### 计算置信区间

1. 测量一个班的学生的身高，叫做采样，得到样本（每个学生的身高值）。
2. 计算平均值：$\mu=\frac{1}{n} \sum_i h_i$，$h_i$ 表示每个学生的身高，$n$ 是学生数量。
3. 计算标准误差（均方根差）：$\sigma=\sqrt{\frac{1}{n} \sum (h_i-\mu)^2}$。
4. 确定置信水平，即“把握”有多大。比如是 90% 呢还是 95%？
5. 查 Z 表。

### 2.6.2 霍夫丁不等式

若 $[X_1,\cdots,X_n]$ 为 [0,1] 之间的随机变量，其均值为 $\bar{X} = \frac{1}{n}(X_1+\cdots+X_n)$，则有

$$
\mathbb P\big[\mathbb E [X] - \bar{X} > u \big ] \le e^{-2nu^2}
$$

可以

- $\mathbb E[X]$，样本期望值，可以看作某个动作的真实价值 $Q(a)$；
- $\bar{X}$，样本均值，可以看作根据历史记录计算出来的某个动作的价值 $\hat{Q}(a)$；
- $n$，样本数量，可以看作选择某个动作的次数 $N(a)$；
- $u$，任意正数，可以看作某个动作的上界 $U(a)$。

$$
\mathbb P[Q(a) - \hat{Q}(a) > U(a)] \le e^{-2N(a)U(a)^2}
$$


令 $p=e^{-2N(a)U(a)^2}$，两边取自然对数运算，得到关于 $U(a)$ 的表达式：

$$U(a) = \sqrt{\frac{-\ln p}{2N(a)}}$$

$p = t^{-4}$


$$
A_t = \argmax_a \Big [Q_t(a) + c\sqrt{\frac{\ln t}{N_t(a)}} \Big ]
$$

由于操作符是 $\argmax_a$，所以后面的表达式中的 $a$ 都是指的动作集中的每个动作都做一次计算，然后取出最大值。

- $A_t$：最终选出的最佳动作。
- $Q_t(a)$：每个动作的价值估算。
- $c$：参数。
- $\ln t$：$t$ 为迭代次数，求其自然对数值。
- $N_t(a)$：每个动作被选择的次数。


