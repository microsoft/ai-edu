

## 租车问题

### 1 提出问题

在北京有一个租车连锁公司，分别在海淀区、朝阳区、通州区、丰台区开设了 4 个门店，编号分别为 A,B,C,D。客户可以从任意一个店租车，用完后归还到任意一个店。公司统计了去年全年的租车、还车记录，发现了如下现象（假设都是当日租当日还）：

- 从A号店租车后
    - 还到A号店的概率是0.1
    - 还到B号店的概率是0.3
    - 还到C号店的概率是0.0
    - 还到D号店的概率是0.6

当然，也统计了从 B,C,D 店租车还车的记录，绘制在图 1 中，避免赘述。

<img src="./img/Car1.png" width="500">

图 1

为了招徕顾客，公司特地买了一辆高档宝驴车，以普通价格出租。公司经理想知道如果有一天这辆车从B号店出租了，3 天后的早晨会在哪个店出现？10 天后又会如何？

一般情况下，读者会根据图 1 从B店出发，根据概率顺藤摸瓜地计算出第2天的情况，再计算出第3天的情况。

- 第 2 天早晨出现在各门店的概率是：0.8, 0.0, 0.2, 0.0。
- 第 3 天早晨出现在各门店的概率是......有点儿复杂，我们绘制出图 2 来帮助整理思路。

<img src="./img/Car2.png" width="600">

图 2

从图2一眼就可以看出来，第 3 天早晨该车出现在各门店的概率就是两个连续的概率之乘积，比如：
- 第 2 天
    - 出现在A店（橙色）的概率是 0.8；
    - 出现在C店（红色）的概率是 0.2；
    - 但是不可能出现在B,D店；
    
- 第 3 天
    - 由于A店有0.3的概率还到B店，所以出现在B店的概率是$0.8 \times 0.3=0.24$；
    - 由于C店有0.9的概率还到B店，所以出现在B店的概率是$0.2 \times 0.9=0.18$；

所以，该车第3天早晨出现在B号店的概率是 $0.24+0.18=0.42$。出现在其它店的数字也可以同理得到。

其它店的所有情况列在表 1 中，便于统计。

表1

|从$\rightarrow$到|A门店|B门店|C门店|D门店|<第2天>|
|-|-|-|-|-|-|
|A号门店|$0.8\times0.1=0.08$|$0.8\times0.3=0.24$|$0.8\times0.0=0.00$|$0.8\times0.6=0.48$|$0.8$|
|B号门店|$0.0\times0.8=0.0$|$0.0\times0.0=0.0$|$0.0\times0.2=0.0$|$0.0\times0.0=0.0$|$0.0$|
|C号门店|$0.2\times0.0=0.00$|$0.2\times0.9=0.18$|$0.2\times0.1=0.02$|$0.2\times0.0=0.00$|$0.2$|
|D号门店|$0.0\times0.0=0.0$|$0.0\times0.3=0.0$|$0.0\times0.3=0.0$|$0.0\times0.4=0.0$|$0.0$|
|< 第3天 >|$0.08$|$0.24+0.18=0.42$|$0.02$|$0.48$|$1.0$|

数据解读：

- 表 1 除去表头，中间部分的 4x4 区域，和图2的数据是一致的。
- 最后一列是中间4列的和，所以正好是第2天的出现概率。
- 最后一行是中间4行的和，所以是第3天的出现概率。

OK! 3天后的问题解决了，那么10天后呢？这么计算太麻烦了，我们引入转移概率矩阵的概念来帮助解决问题。


### 转移概率矩阵

把图1变成表2，方便使用计算机来计算。

表2

|P: 从$\rightarrow$到|A|B|C|D|输出总和|
|:-:|-|-|-|-|-|
|A|0.1|0.3|0.0|0.6|1.0|
|B|0.8|0.0|0.2|0.0|1.0|
|C|0.0|0.9|0.1|0.0|1.0|
|D|0.0|0.3|0.3|0.4|1.0|
|输入总和|0.9|1.5|0.6|1.0|4.0|

- 是一个 $n \times n$ 的方阵（中间的 4x4 区域）。
- 矩阵各元素都是非负的，即：$0 \le P_{i,j} \le 1$。
- 各行元素（输出概率）之和为 1，即：$\sum^n_{j=1} P_{i,j}=1$。
- 对于输入概率总和没有限制，但是最终的总和（右下角）在行列上肯定应该一致，都是4.0（因为有个 4 个门店），即：$\sum_{i=1}^n \sum_{j=1}^n P_{i,j} = n$。

用矩阵来表示

$$
P = 
\begin{bmatrix}
P_{11} & P_{12} & P_{13} & P_{14}
\\
P_{21} & P_{22} & P_{23} & P_{24}
\\
P_{31} & P_{32} & P_{33} & P_{34}
\\
P_{41} & P_{42} & P_{43} & P_{44}
\end{bmatrix}= 
\begin{bmatrix}
0.1 & 0.3 & 0.0 & 0.6
\\
0.8 & 0.0 & 0.2 & 0.0
\\
0.0 & 0.9 & 0.1 & 0.0
\\
0.0 & 0.3 & 0.3 & 0.4
\end{bmatrix}
\tag{1}
$$

而对于一个通用的问题，矩阵形式是：

$$
P = 
\begin{bmatrix}
P_{11} & \cdots & P_{1n}
\\
\vdots & \ddots & \vdots
\\
P_{n1} & \cdots & P_{nn}
\end{bmatrix}
\tag{2}
$$

